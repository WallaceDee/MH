"use strict";(self["webpackChunkweb"]=self["webpackChunkweb"]||[]).push([[907],{8990:function(t,e,s){s.r(e),s.d(e,{default:function(){return y}});s(8111),s(3579);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pet-list-view"},[e("el-card",{staticClass:"filters",attrs:{shadow:"never"}},[e("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[e("div",[e("span",{staticClass:"emoji-icon"},[t._v("ğŸ”")]),t._v(" ç­›é€‰")])]),e("el-form",{attrs:{inline:!0,model:t.filters,size:"mini"},nativeOn:{submit:function(e){return e.preventDefault(),t.fetchPets.apply(null,arguments)}}},[e("el-form-item",{attrs:{label:"ğŸ“…æ•°æ®æœˆä»½"}},[e("el-date-picker",{attrs:{clearable:!1,type:"month",placeholder:"ğŸ“…é€‰æ‹©æœˆä»½",format:"yyyy-MM","value-format":"yyyy-MM"},model:{value:t.filters.selectedDate,callback:function(e){t.$set(t.filters,"selectedDate",e)},expression:"filters.selectedDate"}})],1),e("el-form-item",{attrs:{label:"ğŸ”‘åºåˆ—å·"}},[e("el-input",{attrs:{placeholder:"ğŸ”‘åºåˆ—å·"},model:{value:t.filters.equip_sn,callback:function(e){t.$set(t.filters,"equip_sn",e)},expression:"filters.equip_sn"}})],1),e("el-form-item",{attrs:{label:"ğŸ”¢ç­‰çº§"}},[e("div",{staticStyle:{width:"500px"}},[e("el-slider",{attrs:{range:"",min:0,max:180,step:5,"show-input":"","show-input-controls":"",marks:t.levelMarks},on:{change:t.handleLevelRangeChange},model:{value:t.filters.level_range,callback:function(e){t.$set(t.filters,"level_range",e)},expression:"filters.level_range"}})],1)]),e("el-form-item",{attrs:{label:"ğŸ’²ä»·æ ¼"}},[e("el-input-number",{attrs:{placeholder:"æœ€ä½ä»·æ ¼",min:0,controls:!1},model:{value:t.filters.price_min,callback:function(e){t.$set(t.filters,"price_min",e)},expression:"filters.price_min"}}),t._v(" - "),e("el-input-number",{attrs:{placeholder:"æœ€é«˜ä»·æ ¼",min:0,controls:!1},model:{value:t.filters.price_max,callback:function(e){t.$set(t.filters,"price_max",e)},expression:"filters.price_max"}})],1),e("el-form-item",{attrs:{label:"ğŸ”§æŠ€èƒ½"}},[e("el-cascader",{attrs:{options:t.skillOptions,props:t.cascaderProps,"show-all-levels":!1,placeholder:"ğŸ”§è¯·é€‰æ‹©æŠ€èƒ½",multiple:"",clearable:"",filterable:""},scopedSlots:t._u([{key:"default",fn:function({data:s}){return[e("el-row",{attrs:{type:"flex",align:"middle"}},[s.value?e("el-image",{staticStyle:{display:"block",width:"24px",height:"24px","margin-right":"4px"},attrs:{src:t.getSkillImage(s.value),fit:"cover",referrerpolicy:"no-referrer"}}):t._e(),e("span",[t._v(t._s(s.label))])],1)]}}]),model:{value:t.filters.skills,callback:function(e){t.$set(t.filters,"skills",e)},expression:"filters.skills"}})],1),e("el-form-item",{attrs:{label:"ğŸ”§æŠ€èƒ½æ•°é‡â‰¥"}},[e("el-input-number",{attrs:{placeholder:"ğŸ”§æŠ€èƒ½æ•°é‡",min:0,controls:""},model:{value:t.filters.pet_skill_count,callback:function(e){t.$set(t.filters,"pet_skill_count",e)},expression:"filters.pet_skill_count"}})],1),e("el-form-item",{attrs:{label:"ğŸ“šæˆé•¿"}},[e("el-input-number",{attrs:{placeholder:"ğŸ“šæˆé•¿",min:1,max:1.4,step:.1,controls:""},model:{value:t.filters.pet_growth,callback:function(e){t.$set(t.filters,"pet_growth",e)},expression:"filters.pet_growth"}})],1),e("el-form-item",{attrs:{label:"ğŸ§çµæ€§å€¼â‰¥"}},[e("el-input-number",{attrs:{placeholder:"ğŸ§çµæ€§å€¼",min:0,controls:""},model:{value:t.filters.pet_lx,callback:function(e){t.$set(t.filters,"pet_lx",e)},expression:"filters.pet_lx"}})],1),e("el-form-item",{attrs:{label:"ğŸ”¥ç‰¹æ€§"}},[e("el-select",{attrs:{placeholder:"ğŸ”¥è¯·é€‰æ‹©ç‰¹æ€§",multiple:"",clearable:"",filterable:""},model:{value:t.filters.pet_texing,callback:function(e){t.$set(t.filters,"pet_texing",e)},expression:"filters.pet_texing"}},t._l(t.texing_type_list,function([t,s]){return e("el-option",{key:t,attrs:{label:s,value:t}})}),1)],1),e("el-form-item",{attrs:{label:"âŒä¼°ä»·å¼‚å¸¸"}},[e("el-switch",{attrs:{"active-value":1,"inactive-value":0,"inactive-color":"#409EFF","active-color":"#F56C6C"},model:{value:t.filters.equip_list_amount_warning,callback:function(e){t.$set(t.filters,"equip_list_amount_warning",e)},expression:"filters.equip_list_amount_warning"}})],1),1===t.filters.equip_list_amount_warning?e("el-form-item",{attrs:{label:"ğŸ”è£…å¤‡ä¼°ä»·å¼‚å¸¸å æ¯”ç‡â‰¤"}},[e("el-input-number",{attrs:{placeholder:"è£…å¤‡ä¼°ä»·å¼‚å¸¸å æ¯”ç‡",min:0,max:99,step:.1,controls:""},model:{value:t.filters.warning_rate,callback:function(e){t.$set(t.filters,"warning_rate",e)},expression:"filters.warning_rate"}})],1):t._e(),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.fetchPets}},[t._v("æŸ¥è¯¢")])],1)],1),t.unvaluedPetsCount>0?e("el-alert",{attrs:{type:"warning",loading:t.unvaluedPetsLoading,title:` æœ‰ï¼ˆ${t.unvaluedPetsCount}ï¼‰åªå¬å”¤å…½è£…å¤‡æœªä¼°ä»·/ä¼°ä»·å¼‚å¸¸`,"close-text":"æ›´æ–°"},on:{close:t.batchUpdateUnvaluedPets}}):t._e()],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],key:t.tableKey,staticStyle:{width:"100%"},attrs:{data:t.pets,stripe:""},on:{"sort-change":t.handleSortChange}},[e("el-table-column",{attrs:{prop:"eid",label:"æ“ä½œ",width:"100",fixed:"",align:"center"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-link",{attrs:{href:t.getCBGLinkByType(s.row.eid,"pet"),type:"danger",target:"_blank"}},[t._v("è—å®é˜")]),e("el-divider",{attrs:{direction:"vertical"}}),e("SimilarPetModal",{key:s.row.equip_sn,attrs:{pet:s.row},on:{"valuation-updated":e=>t.handlePetValuationUpdated(e,s.$index)}})]}}])}),e("el-table-column",{attrs:{fixed:"",label:"å¬å”¤å…½",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("PetImage",{attrs:{pet:s.row.petData,equip_sn:s.row.equip_sn,equipFaceImg:s.row.equip_face_img,enhanceInfo:t.getEnhanceInfo(s.row)}})]}}])}),e("el-table-column",{attrs:{fixed:"",prop:"price",label:"ä»·æ ¼ (å…ƒ)",width:"140",sortable:"custom",align:"center"},scopedSlots:t._u([{key:"default",fn:function(s){return[t._v(" "+t._s(s.row.server_name)+" "),e("div",{domProps:{innerHTML:t._s(t.formatFullPrice(s.row))}})]}}])}),e("el-table-column",{attrs:{prop:"highlight",label:"äº®ç‚¹",width:"100",align:"center",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",{domProps:{innerHTML:t._s(t.gen_highlight(s.row.highlight))}})]}}])},[t._v("> ")]),e("el-table-column",{attrs:{prop:"dynamic_tags",label:"åŠ¨æ€",width:"100",align:"center",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",{domProps:{innerHTML:t._s(t.gen_dynamic_tags(s.row.dynamic_tags))}})]}}])}),e("el-table-column",{attrs:{prop:"equip_list",label:"è£…å¤‡",width:"171",sortable:"custom",align:"center"},scopedSlots:t._u([{key:"default",fn:function({row:{equip_list:s,equip_list_amount:a},row:i}){return[e("table",{staticClass:"tb03 size50",attrs:{cellspacing:"0",cellpadding:"0"}},[e("tr",t._l(JSON.parse(s).splice(0,3),function(s,a){return e("td",{key:a},[s?e("EquipmentImage",{attrs:{placement:"bottom",image:!1,equipment:t.getEquipImageProps(s),size:"small",popoverWidth:300}}):e("span",[t._v("Â ")])],1)}),0)]),e("el-row",{attrs:{type:"flex",justify:"space-between",align:"middle"}},[t.getEquipSuitEffect(s)?e("p",{staticClass:"cBlue"},[t._v(t._s(t.getEquipSuitEffect(s))+"å¥—è£…")]):t._e(),t._v(" "),e("span",{domProps:{innerHTML:t._s(t.formatFullPrice({price:a},!0))}})]),JSON.parse(s).slice(0,3).some(t=>t)?e("el-button",{staticStyle:{float:"right"},attrs:{type:"text",size:"mini",loading:t.equipmentValuationLoading,disabled:!JSON.parse(s).some(t=>t)},on:{click:function(e){return t.updatePetEquipmentsPrice(i)}}},[t._v(" è£…å¤‡ä¼°ä»· ")]):t._e()]}}])}),e("el-table-column",{attrs:{prop:"growth",label:"æˆé•¿",width:"100",sortable:"custom",align:"center"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",{domProps:{innerHTML:t._s(t.getColorNumber(s.row.growth,[1,1.3]))}})]}}])}),e("el-table-column",{attrs:{prop:"lx",label:"çµæ€§",width:"80",align:"center",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",{domProps:{innerHTML:t._s(t.getColorNumber(s.row.lx,[80,110]))}})]}}])}),e("el-table-column",{attrs:{prop:"skill_count",label:"æŠ€èƒ½",width:"280",sortable:"custom",align:"center"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",{staticClass:"pet-skills",domProps:{innerHTML:t._s(t.formatSkills(s.row))}})]}}])}),e("el-table-column",{attrs:{prop:"level",label:"ç­‰çº§",width:"140",sortable:"custom",align:"center"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("p",{class:"æ˜¯"===s.row.petData.is_baobao?"cBlue":"equip_desc_red"},[e("span",[t._v(t._s("æ˜¯"===s.row.petData.is_baobao?"":"é‡ç”Ÿ"))]),e("span",[t._v(t._s(s.row.equip_name)+t._s("æ˜¯"===s.row.petData.is_baobao?"å®å®":"")+"/"+t._s(s.row.level)+"çº§")])]),e("p",[t._v("å‚æˆ˜ç­‰çº§ï¼š"+t._s(s.row.role_grade_limit)+"çº§")])]}}])}),e("el-table-column",{attrs:{prop:"petData.texing.name",label:"ç‰¹æ€§",width:"60",align:"center"}}),e("el-table-column",{attrs:{prop:"update_time",label:"åˆ›å»ºã€æ›´æ–°",width:"200"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-tag",{attrs:{type:"info"}},[t._v(t._s(s.row.create_time))]),e("el-tag",[t._v(t._s(s.row.update_time))])]}}])}),e("el-table-column",{attrs:{label:"æ“ä½œ",width:"100"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-link",{attrs:{href:"javascript:void(0)",type:"danger"},nativeOn:{click:function(e){return t.handleDelete(s.row)}}},[t._v("åˆ é™¤")])]}}])})],1),e("div",{staticClass:"pagination-container"},[e("el-pagination",{attrs:{"current-page":t.pagination.page,"page-size":t.pagination.page_size,"page-sizes":[10,100,200,300,400],layout:"total, sizes, prev, pager, next, jumper",total:t.pagination.total},on:{"current-change":t.handlePageChange,"size-change":t.handleSizeChange}})],1),e("el-dialog",{attrs:{title:t.valuationDialogTitle,visible:t.valuationDialogVisible,width:"90%","close-on-click-modal":!1,"close-on-press-escape":!1,"custom-class":"batch-valuation-dialog"},on:{"update:visible":function(e){t.valuationDialogVisible=e}}},[e("EquipBatchValuationResult",{attrs:{results:t.valuationResults,"total-value":t.valuationTotalValue,"equipment-list":t.valuationEquipmentList,"valuate-params":t.batchValuateParams,loading:t.valuationLoading},on:{close:t.closeValuationDialog}})],1),e("el-dialog",{attrs:{title:"æ‰¹é‡æ›´æ–°è¿›åº¦",visible:t.taskProgressVisible,width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(e){t.taskProgressVisible=e}}},[e("div",{staticStyle:{"text-align":"center",padding:"20px"}},[e("div",{staticStyle:{"font-size":"16px","margin-bottom":"20px"}},[t._v(" æ­£åœ¨æ‰¹é‡æ›´æ–°å¬å”¤å…½è£…å¤‡ä¼°ç®—ä»·æ ¼... ")]),e("el-progress",{attrs:{percentage:t.taskStatus&&t.taskStatus.progress_percentage||0,"stroke-width":16,"text-inside":!0}}),e("div",{staticStyle:{"margin-top":"20px","font-size":"14px",color:"#666"}},[t._v(" å·²å¤„ç†: "+t._s(t.taskStatus&&t.taskStatus.processed_count||0)+" / "+t._s(t.taskStatus&&t.taskStatus.total_count||0)+" ")]),e("div",{staticStyle:{"margin-top":"10px","font-size":"14px",color:"#666"}},[t._v(" å½“å‰æ‰¹æ¬¡: "+t._s(t.taskStatus&&t.taskStatus.current_batch||0)+" / "+t._s(t.taskStatus&&t.taskStatus.total_batches||0)+" ")]),e("div",{staticStyle:{"margin-top":"10px","font-size":"14px",color:"#666"}},[t._v(" å·²æ›´æ–°: "+t._s(t.taskStatus&&t.taskStatus.updated_count||0)+" ")])],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"danger"},on:{click:t.stopCurrentTask}},[t._v("åœæ­¢ä»»åŠ¡")])],1)])],1)},i=[],l=(s(4114),s(2489),s(116),s(7588),s(1701),s(8237),s(5868)),n=s(5782),o=s(1488),r=s.n(o),c=s(6130),u=s(3016),p=s(3152),d=s(6175),h=s(8770),g=s(2361);const f=[],m=window.AUTO_SEARCH_CONFIG.pet_skill_classification;for(const w in m)for(const t in m[w])f.push({value:"",label:w.replace("æŠ€èƒ½","")+t,children:m[w][t]});f.reverse();var _={name:"PetList",components:{SimilarPetModal:l.A,PetImage:c.A,EquipmentImage:u.A,EquipBatchValuationResult:n.A},mixins:[d.G,h.B,p.h],data(){return{batchValuateParams:{similarity_threshold:.8,max_anchors:30},tableLoading:!1,cascaderProps:{multiple:!0,checkStrictly:!1,emitPath:!1},texing_type_list:window.AUTO_SEARCH_CONFIG.texing_type_list,skillOptions:f,pets:[],filters:{equip_sn:"",pet_skill_count:0,pet_growth:1,selectedDate:r()().format("YYYY-MM"),level_range:[0,180],skills:[],price_min:void 0,price_max:void 0,sort_by:"price",sort_order:"asc",equip_list_amount_warning:0,warning_rate:.4},pagination:{page:1,page_size:10,total:0},levelMarks:{60:"60",90:"90",120:"120",150:"150"},tableKey:0,equipmentValuationLoading:!1,valuationDialogVisible:!1,valuationResults:[],valuationTotalValue:0,valuationEquipmentList:[],valuationLoading:!1,valuationDialogTitle:"",unvaluedPetsCount:0,unvaluedPetsLoading:!1,currentTaskId:null,taskStatus:{},taskProgressTimer:null,taskProgressVisible:!1,taskProgressPercentage:0,taskProgressProcessed:0,taskProgressTotal:0,taskProgressCurrentBatch:0,taskProgressTotalBatches:0,taskProgressUpdated:0}},methods:{async updatePetEquipmentsPrice({equip_sn:t,equip_list:e,equip_name:s}){try{this.equipmentValuationLoading=!0;const a=JSON.parse(e).filter((t,e)=>t&&t.desc&&e<3).map(t=>({...t,kindid:29}));this.valuationDialogVisible=!0,this.valuationLoading=!0,this.valuationResults=[],this.valuationTotalValue=0,this.valuationEquipmentList=a,this.valuationDialogTitle=`å¬å”¤å…½è£…å¤‡ä¼°ä»·ç»“æœ - ${s}`;const i=await g.g.updatePetEquipmentsPrice({equip_sn:t,strategy:"fair_value",similarity_threshold:this.batchValuateParams.similarity_threshold,max_anchors:this.batchValuateParams.max_anchors,year:1*this.filters.selectedDate.split("-")[0],month:1*this.filters.selectedDate.split("-")[1]});if(200===i.code){const t=i.data,e=t.results||[],s=e.reduce((t,e)=>t+(e.estimated_price||0),0);if(0===e.length)return this.$notify.warning("è¯¥å¬å”¤å…½æ²¡æœ‰æºå¸¦è£…å¤‡æˆ–è£…å¤‡ä¼°ä»·å¤±è´¥"),void this.closeValuationDialog();this.valuationResults=e,this.valuationTotalValue=s,this.valuationLoading=!1}else this.$notify.error(i.message||"å¬å”¤å…½è£…å¤‡ä¼°ä»·å¤±è´¥"),this.closeValuationDialog()}catch(a){console.error("å¬å”¤å…½è£…å¤‡ä¼°ä»·å¤±è´¥:",a),this.$notify.error("å¬å”¤å…½è£…å¤‡ä¼°ä»·å¤±è´¥"),this.closeValuationDialog()}finally{this.equipmentValuationLoading=!1}},async fetchPets(){const[t,e]=this.filters.selectedDate.split("-");try{this.tableLoading=!0;const s={...this.filters,year:t,month:e,page:this.pagination.page,page_size:this.pagination.page_size};this.filters.level_range&&Array.isArray(this.filters.level_range)&&(s.level_min=this.filters.level_range[0],s.level_max=this.filters.level_range[1],delete s.level_range),this.filters.skills&&Array.isArray(this.filters.skills)&&this.filters.skills.length>0&&(s.pet_skills=this.filters.skills,delete s.skills),Object.keys(s).forEach(t=>{(null===s[t]||""===s[t]||Array.isArray(s[t])&&0===s[t].length)&&delete s[t]});const a=await this.$api.pet.getPetList(s);200===a.code?(this.pets=a.data.data.map(t=>{const e=this.parsePetInfo(t.desc);return{...t,petData:e}})||[],this.pagination.total=a.data.total||0,this.pagination.page=a.data.page||this.pagination.page):this.$notify.error(a.message||"è·å–å¬å”¤å…½åˆ—è¡¨å¤±è´¥")}catch(s){console.error("è·å–å¬å”¤å…½åˆ—è¡¨å¤±è´¥:",s),this.$notify.error("è·å–å¬å”¤å…½åˆ—è¡¨å¤±è´¥")}finally{this.tableLoading=!1}},handleSizeChange(t){this.pagination.page_size=t,this.pagination.page=1,this.fetchPets()},handlePageChange(t){this.pagination.page=t,this.fetchPets()},handleSortChange({prop:t,order:e}){this.filters.sort_by=t,this.filters.sort_order="ascending"===e?"asc":"desc",this.fetchPets()},handleLevelRangeChange(t){this.filters.level_range=t},closeValuationDialog(){this.valuationDialogVisible=!1,this.valuationResults=[],this.valuationTotalValue=0,this.valuationEquipmentList=[],this.valuationLoading=!1,this.valuationDialogTitle=""},handlePetValuationUpdated(t,e){console.log("å¬å”¤å…½ä¼°ä»·ç»“æœæ›´æ–°:",t,"ç´¢å¼•:",e)},async getUnvaluedPetsCount(){try{this.unvaluedPetsLoading=!0;const[t,e]=this.filters.selectedDate.split("-"),s=await g.g.getUnvaluedPetsCount({year:parseInt(t),month:parseInt(e)});200===s.code?this.unvaluedPetsCount=s.data.count||0:console.error("è·å–æœªä¼°ä»·å¬å”¤å…½æ•°é‡å¤±è´¥:",s.message)}catch(t){console.error("è·å–æœªä¼°ä»·å¬å”¤å…½æ•°é‡å¤±è´¥:",t)}finally{this.unvaluedPetsLoading=!1}},async batchUpdateUnvaluedPets(){try{this.unvaluedPetsLoading=!0;const[t,e]=this.filters.selectedDate.split("-");await this.$confirm(`ç¡®å®šè¦æ‰¹é‡æ›´æ–° ${this.unvaluedPetsCount} åªæœªä¼°ä»·å¬å”¤å…½çš„è£…å¤‡ä»·æ ¼å—ï¼Ÿæ­¤æ“ä½œå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ã€‚`,"æ‰¹é‡ä¼°ä»·ç¡®è®¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});const s=await g.g.batchUpdateUnvaluedPets({year:parseInt(t),month:parseInt(e)});if(200===s.code){const t=s.data;this.currentTaskId=t.task_id,this.taskStatus=t,this.showTaskProgressDialog(),this.startTaskProgressMonitoring()}else this.$notify.error(s.message||"æ‰¹é‡æ›´æ–°å¤±è´¥")}catch(t){"cancel"!==t&&(console.error("æ‰¹é‡æ›´æ–°æœªä¼°ä»·å¬å”¤å…½è£…å¤‡å¤±è´¥:",t),this.$notify.error("æ‰¹é‡æ›´æ–°å¤±è´¥"))}finally{this.unvaluedPetsLoading=!1}},showTaskProgressDialog(){this.taskProgressVisible=!0},startTaskProgressMonitoring(){this.taskProgressTimer=setInterval(async()=>{if(this.currentTaskId)try{const t=await g.g.getTaskStatus(this.currentTaskId);200===t.code&&(this.taskStatus=t.data,this.taskStatus&&"completed"===this.taskStatus.status?this.handleTaskCompleted():this.taskStatus&&"failed"===this.taskStatus.status?this.handleTaskFailed():this.taskStatus&&"cancelled"===this.taskStatus.status&&this.handleTaskCancelled())}catch(t){console.error("è·å–ä»»åŠ¡çŠ¶æ€å¤±è´¥:",t)}else this.stopTaskProgressMonitoring()},1e4)},stopTaskProgressMonitoring(){this.taskProgressTimer&&(clearInterval(this.taskProgressTimer),this.taskProgressTimer=null)},async stopCurrentTask(){if(this.currentTaskId)try{await g.g.stopTask(this.currentTaskId),this.$notify.info("å·²å‘é€åœæ­¢ä»»åŠ¡è¯·æ±‚"),this.waitForTaskCancelled()}catch(t){console.error("åœæ­¢ä»»åŠ¡å¤±è´¥:",t)}},async waitForTaskCancelled(){const t=1e4,e=1e3,s=Date.now();console.log("å¼€å§‹ç­‰å¾…ä»»åŠ¡å–æ¶ˆ...");while(Date.now()-s<t){try{const t=await g.g.getTaskStatus(this.currentTaskId);if(200===t.code&&t.data){const e=t.data.status;if(console.log(`ä»»åŠ¡çŠ¶æ€: ${e}`),"cancelled"===e)return console.log("ä»»åŠ¡å·²å–æ¶ˆï¼Œå…³é—­å¼¹çª—"),void this.handleTaskCancelled();if("completed"===e||"failed"===e)return console.log(`ä»»åŠ¡çŠ¶æ€ä¸º ${e}ï¼Œå…³é—­å¼¹çª—`),void("completed"===e?this.handleTaskCompleted():this.handleTaskFailed())}}catch(a){console.error("æ£€æŸ¥ä»»åŠ¡çŠ¶æ€å¤±è´¥:",a)}await new Promise(t=>setTimeout(t,e))}console.warn("ç­‰å¾…ä»»åŠ¡å–æ¶ˆè¶…æ—¶ï¼Œå¼ºåˆ¶å…³é—­å¼¹çª—"),this.handleTaskCancelled()},handleTaskCompleted(){this.stopTaskProgressMonitoring(),this.taskProgressVisible=!1,this.taskStatus?this.$notify.success(`æ‰¹é‡æ›´æ–°å®Œæˆï¼æˆåŠŸæ›´æ–° ${this.taskStatus.updated_count||0}/${this.taskStatus.total_count||0} åªå¬å”¤å…½çš„è£…å¤‡ä»·æ ¼ã€‚`):this.$notify.success("æ‰¹é‡æ›´æ–°å®Œæˆï¼"),this.currentTaskId=null,this.taskStatus=null,this.getUnvaluedPetsCount(),this.fetchPets()},handleTaskFailed(){this.stopTaskProgressMonitoring(),this.taskProgressVisible=!1,this.taskStatus?this.$notify.error(`ä»»åŠ¡å¤±è´¥: ${this.taskStatus.error_message||"æœªçŸ¥é”™è¯¯"}`):this.$notify.error("ä»»åŠ¡å¤±è´¥: æœªçŸ¥é”™è¯¯"),this.currentTaskId=null,this.taskStatus=null},handleTaskCancelled(){this.stopTaskProgressMonitoring(),this.taskProgressVisible=!1,this.$notify.info("ä»»åŠ¡å·²å–æ¶ˆ"),this.currentTaskId=null,this.taskStatus=null},async handleDelete(t){try{await this.$confirm(`ç¡®å®šè¦åˆ é™¤å¬å”¤å…½ ${t.equip_name||t.equip_sn} å—ï¼Ÿ`,"ç¡®è®¤åˆ é™¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});const[e,s]=this.filters.selectedDate.split("-"),a=await g.g.deletePet(t.equip_sn,{year:e,month:s});200===a.code?(this.$notify.success("å¬å”¤å…½åˆ é™¤æˆåŠŸ"),await this.fetchPets()):this.$notify.error(a.message||"åˆ é™¤å¤±è´¥")}catch(e){"cancel"!==e&&(console.error("åˆ é™¤å¬å”¤å…½å¤±è´¥:",e),this.$notify.error("åˆ é™¤å¬å”¤å…½å¤±è´¥"))}},async checkActiveTasks(){try{console.log("å¼€å§‹æ£€æŸ¥æ´»è·ƒä»»åŠ¡...");const t=await g.g.getActiveTasks();if(console.log("æ´»è·ƒä»»åŠ¡APIå“åº”:",t),200===t.code&&t.data&&t.data.length>0){console.log("æ‰¾åˆ°æ´»è·ƒä»»åŠ¡:",t.data);const[e,s]=this.filters.selectedDate.split("-");console.log("å½“å‰å¹´æœˆ:",e,s);const a=t.data.find(t=>(console.log("æ¯”è¾ƒä»»åŠ¡:",t.year,t.month,"vs",e,s),t.year===parseInt(e)&&t.month===parseInt(s)));console.log("åŒ¹é…çš„å½“å‰ä»»åŠ¡:",a),a?(this.currentTaskId=a.task_id,this.taskStatus=a,"running"===a.status?(console.log("æ¢å¤è¿è¡Œä¸­çš„ä»»åŠ¡:",a.task_id),this.showTaskProgressDialog(),this.startTaskProgressMonitoring(),this.$notify.info("æ£€æµ‹åˆ°æœªå®Œæˆçš„ä»»åŠ¡ï¼Œå·²æ¢å¤ç›‘æ§")):"pending"===a.status&&(console.log("å‘ç°å¾…å¤„ç†ä»»åŠ¡:",a.task_id),this.$notify.info("æ£€æµ‹åˆ°å¾…å¤„ç†çš„ä»»åŠ¡ï¼Œæ­£åœ¨ç­‰å¾…æ‰§è¡Œ"))):console.log("æœªæ‰¾åˆ°å½“å‰å¹´æœˆçš„æ´»è·ƒä»»åŠ¡")}else console.log("æ²¡æœ‰æ´»è·ƒä»»åŠ¡æˆ–APIå“åº”å¼‚å¸¸")}catch(t){console.error("æ£€æŸ¥æ´»è·ƒä»»åŠ¡å¤±è´¥:",t)}}},mounted(){this.fetchPets(),this.getUnvaluedPetsCount(),this.checkActiveTasks()},beforeDestroy(){this.stopTaskProgressMonitoring()}},k=_,v=s(1656),b=(0,v.A)(k,a,i,!1,null,"632a50a3",null),y=b.exports}}]);
//# sourceMappingURL=907.6dea1789.js.map