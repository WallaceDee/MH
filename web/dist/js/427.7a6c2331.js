(self["webpackChunkweb"]=self["webpackChunkweb"]||[]).push([[427],{1488:function(t){!function(e,i){t.exports=i()}(0,function(){"use strict";var t=1e3,e=6e4,i=36e5,a="millisecond",r="second",n="minute",s="hour",o="day",l="week",c="month",u="quarter",d="year",h="date",p="Invalid Date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,m=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],i=t%100;return"["+t+(e[(i-20)%10]||e[i]||e[0])+"]"}},v=function(t,e,i){var a=String(t);return!a||a.length>=e?t:""+Array(e+1-a.length).join(i)+t},_={s:v,z:function(t){var e=-t.utcOffset(),i=Math.abs(e),a=Math.floor(i/60),r=i%60;return(e<=0?"+":"-")+v(a,2,"0")+":"+v(r,2,"0")},m:function t(e,i){if(e.date()<i.date())return-t(i,e);var a=12*(i.year()-e.year())+(i.month()-e.month()),r=e.clone().add(a,c),n=i-r<0,s=e.clone().add(a+(n?-1:1),c);return+(-(a+(i-r)/(n?r-s:s-r))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:c,y:d,w:l,d:o,D:h,h:s,m:n,s:r,ms:a,Q:u}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},y="en",w={};w[y]=g;var $="$isDayjsObject",x=function(t){return t instanceof C||!(!t||!t[$])},b=function t(e,i,a){var r;if(!e)return y;if("string"==typeof e){var n=e.toLowerCase();w[n]&&(r=n),i&&(w[n]=i,r=n);var s=e.split("-");if(!r&&s.length>1)return t(s[0])}else{var o=e.name;w[o]=e,r=o}return!a&&r&&(y=r),r||!a&&y},S=function(t,e){if(x(t))return t.clone();var i="object"==typeof e?e:{};return i.date=t,i.args=arguments,new C(i)},D=_;D.l=b,D.i=x,D.w=function(t,e){return S(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var C=function(){function g(t){this.$L=b(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[$]=!0}var v=g.prototype;return v.parse=function(t){this.$d=function(t){var e=t.date,i=t.utc;if(null===e)return new Date(NaN);if(D.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var a=e.match(f);if(a){var r=a[2]-1||0,n=(a[7]||"0").substring(0,3);return i?new Date(Date.UTC(a[1],r,a[3]||1,a[4]||0,a[5]||0,a[6]||0,n)):new Date(a[1],r,a[3]||1,a[4]||0,a[5]||0,a[6]||0,n)}}return new Date(e)}(t),this.init()},v.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},v.$utils=function(){return D},v.isValid=function(){return!(this.$d.toString()===p)},v.isSame=function(t,e){var i=S(t);return this.startOf(e)<=i&&i<=this.endOf(e)},v.isAfter=function(t,e){return S(t)<this.startOf(e)},v.isBefore=function(t,e){return this.endOf(e)<S(t)},v.$g=function(t,e,i){return D.u(t)?this[e]:this.set(i,t)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(t,e){var i=this,a=!!D.u(e)||e,u=D.p(t),p=function(t,e){var r=D.w(i.$u?Date.UTC(i.$y,e,t):new Date(i.$y,e,t),i);return a?r:r.endOf(o)},f=function(t,e){return D.w(i.toDate()[t].apply(i.toDate("s"),(a?[0,0,0,0]:[23,59,59,999]).slice(e)),i)},m=this.$W,g=this.$M,v=this.$D,_="set"+(this.$u?"UTC":"");switch(u){case d:return a?p(1,0):p(31,11);case c:return a?p(1,g):p(0,g+1);case l:var y=this.$locale().weekStart||0,w=(m<y?m+7:m)-y;return p(a?v-w:v+(6-w),g);case o:case h:return f(_+"Hours",0);case s:return f(_+"Minutes",1);case n:return f(_+"Seconds",2);case r:return f(_+"Milliseconds",3);default:return this.clone()}},v.endOf=function(t){return this.startOf(t,!1)},v.$set=function(t,e){var i,l=D.p(t),u="set"+(this.$u?"UTC":""),p=(i={},i[o]=u+"Date",i[h]=u+"Date",i[c]=u+"Month",i[d]=u+"FullYear",i[s]=u+"Hours",i[n]=u+"Minutes",i[r]=u+"Seconds",i[a]=u+"Milliseconds",i)[l],f=l===o?this.$D+(e-this.$W):e;if(l===c||l===d){var m=this.clone().set(h,1);m.$d[p](f),m.init(),this.$d=m.set(h,Math.min(this.$D,m.daysInMonth())).$d}else p&&this.$d[p](f);return this.init(),this},v.set=function(t,e){return this.clone().$set(t,e)},v.get=function(t){return this[D.p(t)]()},v.add=function(a,u){var h,p=this;a=Number(a);var f=D.p(u),m=function(t){var e=S(p);return D.w(e.date(e.date()+Math.round(t*a)),p)};if(f===c)return this.set(c,this.$M+a);if(f===d)return this.set(d,this.$y+a);if(f===o)return m(1);if(f===l)return m(7);var g=(h={},h[n]=e,h[s]=i,h[r]=t,h)[f]||1,v=this.$d.getTime()+a*g;return D.w(v,this)},v.subtract=function(t,e){return this.add(-1*t,e)},v.format=function(t){var e=this,i=this.$locale();if(!this.isValid())return i.invalidDate||p;var a=t||"YYYY-MM-DDTHH:mm:ssZ",r=D.z(this),n=this.$H,s=this.$m,o=this.$M,l=i.weekdays,c=i.months,u=i.meridiem,d=function(t,i,r,n){return t&&(t[i]||t(e,a))||r[i].slice(0,n)},h=function(t){return D.s(n%12||12,t,"0")},f=u||function(t,e,i){var a=t<12?"AM":"PM";return i?a.toLowerCase():a};return a.replace(m,function(t,a){return a||function(t){switch(t){case"YY":return String(e.$y).slice(-2);case"YYYY":return D.s(e.$y,4,"0");case"M":return o+1;case"MM":return D.s(o+1,2,"0");case"MMM":return d(i.monthsShort,o,c,3);case"MMMM":return d(c,o);case"D":return e.$D;case"DD":return D.s(e.$D,2,"0");case"d":return String(e.$W);case"dd":return d(i.weekdaysMin,e.$W,l,2);case"ddd":return d(i.weekdaysShort,e.$W,l,3);case"dddd":return l[e.$W];case"H":return String(n);case"HH":return D.s(n,2,"0");case"h":return h(1);case"hh":return h(2);case"a":return f(n,s,!0);case"A":return f(n,s,!1);case"m":return String(s);case"mm":return D.s(s,2,"0");case"s":return String(e.$s);case"ss":return D.s(e.$s,2,"0");case"SSS":return D.s(e.$ms,3,"0");case"Z":return r}return null}(t)||r.replace(":","")})},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(a,h,p){var f,m=this,g=D.p(h),v=S(a),_=(v.utcOffset()-this.utcOffset())*e,y=this-v,w=function(){return D.m(m,v)};switch(g){case d:f=w()/12;break;case c:f=w();break;case u:f=w()/3;break;case l:f=(y-_)/6048e5;break;case o:f=(y-_)/864e5;break;case s:f=y/i;break;case n:f=y/e;break;case r:f=y/t;break;default:f=y}return p?f:D.a(f)},v.daysInMonth=function(){return this.endOf(c).$D},v.$locale=function(){return w[this.$L]},v.locale=function(t,e){if(!t)return this.$L;var i=this.clone(),a=b(t,e,!0);return a&&(i.$L=a),i},v.clone=function(){return D.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},g}(),M=C.prototype;return S.prototype=M,[["$ms",a],["$s",r],["$m",n],["$H",s],["$W",o],["$M",c],["$y",d],["$D",h]].forEach(function(t){M[t[1]]=function(e){return this.$g(e,t[0],t[1])}}),S.extend=function(t,e){return t.$i||(t(e,C,S),t.$i=!0),S},S.locale=b,S.isDayjs=x,S.unix=function(t){return S(1e3*t)},S.en=w[y],S.Ls=w,S.p={},S})},2369:function(t,e,i){"use strict";i.d(e,{A:function(){return p}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"batch-valuation-result",style:t.$attrs.style},[t.loading?e("div",{staticClass:"skeleton-container"},[e("el-skeleton",{attrs:{rows:12,animated:""}})],1):[e("div",{staticClass:"result-item",class:t.getOverviewClass(),staticStyle:{"min-height":"unset"}},[e("el-row",{staticStyle:{"margin-bottom":"20px"},attrs:{gutter:20}},[e("el-col",{attrs:{span:6}},[e("el-statistic",{attrs:{"group-separator":",",precision:2,value:t.currentTotalValue/100,title:"估价总值","value-style":{fontSize:"28px",fontWeight:"bold"}}},[e("template",{slot:"formatter"},[e("span",{domProps:{innerHTML:t._s(t.formatPrice(t.currentTotalValue))}})])],2)],1),e("el-col",{attrs:{span:6}},[e("el-statistic",{attrs:{"group-separator":",",precision:0,value:t.successCount,title:"成功估价","value-style":{fontSize:"28px",fontWeight:"bold",color:"#67c23a"}}},[e("template",{slot:"suffix"},[e("span",{staticStyle:{color:"#909399","font-size":"16px"}},[t._v("/ "+t._s(t.totalCount))])])],2)],1)],1)],1),e("el-row",{staticStyle:{"flex-wrap":"wrap"},attrs:{type:"flex"}},t._l(t.currentList,function(i,a){return e("el-col",{key:i.equip_sn||a,staticClass:"result-item",class:t.getResultItemClass(i),attrs:{span:t.colSpan}},[e("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[e("el-col",{staticStyle:{width:"50px"}},[e("EquipmentImage",{attrs:{placement:"top",image:!1,equipment:t.getEquipImageProps(i),"lock-type":i.lock_type,size:"small",popoverWidth:300}})],1),e("el-col",{staticClass:"price-info",staticStyle:{width:"calc(100% - 50px)"}},[e("el-statistic",{attrs:{"value-style":t.getPriceStyle(i.confidence)}},[e("template",{slot:"formatter"},[e("span",{domProps:{innerHTML:t._s(t.formatPrice(i.estimated_price))}})])],2)],1)],1),e("div",{staticClass:"result-footer"},[e("SimilarEquipmentModal",{key:i.equip_sn,attrs:{equipment:i,"similar-data":t.similarData},on:{"valuation-updated":e=>t.handleValuationUpdated(e,i.resultIndex)}},[e("el-link",{staticStyle:{"font-weight":"bold"},attrs:{href:"javascript:void(0)",type:"primary"}},[t._v(t._s(i.name||`装备 ${a+1}`))])],1),i.error?e("el-tag",{attrs:{type:"danger",title:i.error}},[t._v("估价失败")]):e("el-tag",{attrs:{type:t.getConfidenceTagType(i.confidence)}},[t._v(" 置信度: "+t._s((100*i.confidence).toFixed(1))+"% ")])],1),e("div",{staticClass:"equip-tag-info"},[t.getEquipGemInfoAndBlueBlock(i.cDesc).gemLevel?e("el-tag",{attrs:{type:"success"}},[t._v(t._s(t.getEquipGemInfoAndBlueBlock(i.cDesc).gemLevel)+"锻")]):t._e(),t._l(t.getEquipGemInfoAndBlueBlock(i.cDesc).blueBlock,function(i){return e("el-tag",{key:i,attrs:{type:"primary"}},[t._v(t._s(i))])})],2)],1)}),1)],e("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center","margin-top":"20px"}},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.$emit("close")}}},[t._v("关闭")])],1)],2)},r=[],n=(i(8111),i(2489),i(1701),i(3016)),s=i(9414),o=i(6175),l=i(8770),c={name:"EquipBatchValuationResult",props:{results:{type:Array,required:!0},equipmentList:{type:Array,required:!0},totalValue:{type:Number,default:0},valuateParams:{type:Object,required:!0},loading:{type:Boolean,default:!1},colSpan:{type:Number,default:6}},data(){return{similarData:null,currentTotalValue:0,currentList:[]}},mixins:[o.G,l.B],components:{EquipmentImage:n.A,SimilarEquipmentModal:s.A},watch:{totalValue(t){this.currentTotalValue=t},results(t){t&&t.length>0&&this.initializeCurrentList()}},computed:{totalCount(){return this.results.length},successCount(){return this.results.filter(t=>!t.error).length}},mounted(){this.currentTotalValue=this.totalValue,this.results&&this.results.length>0&&this.initializeCurrentList()},methods:{initializeCurrentList(){const t=this.results.map((t,e)=>({...this.equipmentList[e],...t,resultIndex:e})),e=t.filter(t=>1===t.confidence),i=t.filter(t=>1!==t.confidence);e.sort((t,e)=>t.estimated_price-e.estimated_price),i.sort((t,e)=>t.confidence-e.confidence),this.currentList=[...i,...e]},handleValuationUpdated(t,e){if(console.log("收到估价更新事件, resultIndex:",e,"data:",t),void 0===e||e<0||e>=this.results.length)return void console.error("无效的resultIndex:",e);const i=this.results[e];if(!i)return void console.error("未找到原始结果数据, resultIndex:",e);const a=i.estimated_price||0,r=t.estimated_price||0;this.currentTotalValue=this.currentTotalValue-a+r,this.$set(this.results,e,{...this.equipmentList[e],...t}),console.log("估价数据更新完成, 新置信度:",t.confidence),this.$emit("valuation-updated",t,e)},getConfidenceTagType(t){return t>=.9?"success":t>=.7?"":t>=.5?"info":t>=.3?"warning":"danger"},getResultItemClass(t){if(t.error)return"error";const e=t.confidence||0;return e>=.9?"confidence-high":e>=.7?"confidence-medium":e>=.5?"confidence-low":e>=.3?"confidence-very-low":"confidence-extremely-low"},getPriceStyle(t){const e={fontSize:"18px",fontWeight:"bold",justifyContent:"end"};return!t||t<.3?{...e,color:"#f56c6c"}:t<.5?{...e,color:"#e6a23c"}:t<.7?{...e,color:"#909399"}:t<.9?{...e,color:"#409eff"}:{...e,color:"#67c23a"}},getOverviewClass(){const t=this.totalCount>0?this.successCount/this.totalCount:0;return t>=.9?"confidence-high":t>=.7?"confidence-medium":t>=.5?"confidence-low":t>=.3?"confidence-very-low":"confidence-extremely-low"}}},u=c,d=i(1656),h=(0,d.A)(u,a,r,!1,null,"3d953848",null),p=h.exports},4302:function(t,e,i){"use strict";i.d(e,{A:function(){return C}});var a=function(){var t=this,e=t._self._c;return e("el-popover",{attrs:{"data-equip-sn":t.pet.equip_sn,placement:t.placement,width:"860",trigger:"click","popper-class":"similar-pet-popper"},on:{show:t.handleShow},scopedSlots:t._u([{key:"reference",fn:function(){return[t._t("default",function(){return[e("el-link",{staticStyle:{"font-size":"12px"},attrs:{type:"primary"}},[t._v("查看相似")])]})]},proxy:!0}],null,!0),model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[t.visible?e("div",[t.valuationLoading?e("div",{staticClass:"loading-info"},[e("el-skeleton",{attrs:{rows:12,animated:""}})],1):t.similarData?e("div",[e("div",{staticClass:"similar-header"},[e("h4",[t._v("相似召唤兽 (共"+t._s(t.similarData.anchor_count)+"个) "),e("el-divider",{attrs:{direction:"vertical"}}),e("el-tag",{attrs:{type:"info",size:"mini"}},[t._v("相似度阈值: "+t._s(t.similarData.similarity_threshold))]),e("el-divider",{attrs:{direction:"vertical"}}),e("el-tag",{attrs:{type:"info",size:"mini"}},[t._v("最大锚点数: "+t._s(t.similarData.max_anchors))])],1),e("PetValuation",{attrs:{valuation:t.petValuation,"target-pet":t.pet,equip_sn:t.pet.equip_sn},on:{refresh:t.refresh}}),t.similarData.statistics?e("div",{staticClass:"stats"},[e("span",[t._v(" 价格范围: "),e("span",{domProps:{innerHTML:t._s(t.formatPrice(t.similarData.statistics.price_range.min))}}),t._v(" - "),e("span",{domProps:{innerHTML:t._s(t.formatPrice(t.similarData.statistics.price_range.max))}})]),e("span",[t._v(" 平均相似度: "+t._s(t.similarData.statistics.similarity_range.avg.toFixed(3))+" ")])]):t._e()],1),t.anchorsLoading||t.similarData?.anchors?.length?e("SimilarPetTable",{directives:[{name:"loading",rawName:"v-loading",value:t.anchorsLoading,expression:"anchorsLoading"}],attrs:{anchors:t.similarData.anchors,"element-loading-text":"正在加载相似召唤兽","target-pet":t.pet}}):e("el-empty",{attrs:{description:"暂无数据"}})],1):t._e()]):t._e()])},r=[],n=(i(8111),i(1701),i(8237),function(){var t=this,e=t._self._c;return e("div",{staticClass:"valuation-info",class:t.confidenceClass},[e("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[e("el-row",{attrs:{type:"flex",align:"middle"}},[e("PetImage",{attrs:{pet:t.targetPet.petData,trigger:"hover",equipFaceImg:t.targetPet.equip_face_img}}),e("span",{staticStyle:{"margin-left":"10px"},domProps:{innerHTML:t._s(t.formatFullPrice(t.targetPet))}})],1),e("div",{staticStyle:{width:"170px","flex-shrink":"0"}},[e("el-button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.$emit("refresh")}}},[t._v("刷新")]),e("SimilarGetMore",{attrs:{"target-equipment":t.targetPet,type:"pet"}})],1)],1),e("div",{staticClass:"valuation-main"},[e("span",{staticClass:"valuation-label"},[t._v("召唤兽估价:")]),e("span",{staticClass:"valuation-price"},[t._v(t._s(t.valuation?(t.valuation.estimated_price_yuan+t.valuation.equip_estimated_price/100).toFixed(2)+"元":"-")+" ")]),e("span",{staticClass:"valuation-strategy"},[t._v("("+t._s(t.valuation?t.getStrategyName(t.valuation.strategy):"-")+")")]),t.priceRatio?e("span",{staticClass:"price-ratio",class:t.priceRatioClass},[e("el-tag",{attrs:{type:t.priceRatioTagType,"disable-transitions":""}},[t._v(" "+t._s(t.priceRatioText)+" ")])],1):t._e()]),e("div",{staticClass:"valuation-equip"},[e("el-tag",[t._v("裸宠:￥"+t._s(t.valuation.estimated_price_yuan))]),t._v(" "),e("el-divider",{attrs:{direction:"vertical"}}),e("el-tag",{attrs:{type:"success"}},[t._v("装备:￥"+t._s(t.valuation.equip_estimated_price/100))])],1),e("div",{staticClass:"valuation-details"},[e("span",{staticClass:"confidence-display",class:t.confidenceTextClass},[e("i",{class:t.confidenceIcon}),t._v(" 置信度: "+t._s(t.valuation?(100*t.valuation.confidence).toFixed(1)+"%":"-")+" "),e("span",{staticClass:"confidence-level"},[t._v(t._s(t.confidenceLevel))])]),e("span",[t._v("基于"+t._s(t.valuation?t.valuation.anchor_count+"个锚点":"-"))]),t.priceRatio?e("span",[t._v("估价比率: "+t._s((100*t.priceRatio).toFixed(1))+"%")]):t._e()])],1)}),s=[],o=i(6130),l=i(3152),c=i(8770),u=i(388),d={name:"PetValuation",components:{PetImage:o.A,SimilarGetMore:u.A},mixins:[l.h,c.B],props:{valuation:{type:Object,default:null},targetPet:{type:Object,required:!0}},computed:{priceRatio(){if(!this.valuation||!this.valuation.estimated_price_yuan||!this.targetPet.price)return null;const t=parseFloat(this.valuation.estimated_price),e=parseFloat(this.targetPet.price);return 0===e?null:t/e},priceRatioText(){if(!this.priceRatio)return"";const t=this.priceRatio,e=100*Math.abs(t-1);return e<5?`估价极为贴合市场（±${e.toFixed(1)}%）`:e<10?`估价较为贴合（±${e.toFixed(1)}%）`:e<20?`估价有一定偏差（±${e.toFixed(1)}%）`:t>1?`估价高于市场（+${(100*(t-1)).toFixed(1)}%）`:`估价低于市场（-${(100*(1-t)).toFixed(1)}%）`},priceRatioClass(){if(!this.priceRatio)return"";const t=this.priceRatio;return t>1.2?"ratio-low":t<.8?"ratio-high":"ratio-normal"},priceRatioTagType(){if(!this.priceRatio)return"";const t=this.priceRatio,e=100*Math.abs(t-1);return e<5?"success":e<10?"info":e<20?"warning":"danger"},confidenceClass(){if(!this.valuation||!this.valuation.confidence)return"confidence-extremely-low";const t=this.valuation.confidence;return t>=.8?"confidence-high":t>=.6?"confidence-medium":t>=.4?"confidence-low":t>=.2?"confidence-very-low":"confidence-extremely-low"},confidenceTextClass(){if(!this.valuation||!this.valuation.confidence)return"text-danger";const t=this.valuation.confidence;return t>=.8?"text-success":t>=.6?"text-primary":t>=.4?"text-info":t>=.2?"text-warning":"text-danger"},confidenceIcon(){if(!this.valuation||!this.valuation.confidence)return"el-icon-warning";const t=this.valuation.confidence;return t>=.8?"el-icon-success":t>=.6?"el-icon-info":t>=.4?"el-icon-warning":"el-icon-error"},confidenceLevel(){if(!this.valuation||!this.valuation.confidence)return"极低";const t=this.valuation.confidence;return t>=.8?"高":t>=.6?"中":t>=.4?"较低":t>=.2?"很低":"极低"}},methods:{getStrategyName(t){const e={fair_value:"公允价值",market_price:"市场价格",weighted_average:"加权平均"};return e[t]||t}}},h=d,p=i(1656),f=(0,p.A)(h,n,s,!1,null,"bf1a830a",null),m=f.exports,g=function(){var t=this,e=t._self._c;return e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.anchors,stripe:"","max-height":"300",sortable:"","sort-by":["price","similarity"],"sort-order":["ascending","descending"]}},[e("el-table-column",{attrs:{fixed:"",prop:"price",label:"价格 (元)",width:"140",sortable:""},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v(t._s(i.row.server_name))]),e("div",{domProps:{innerHTML:t._s(t.formatFullPrice(i.row))}})]}}])}),e("el-table-column",{attrs:{fixed:"",label:"召唤兽",width:"70"},scopedSlots:t._u([{key:"default",fn:function(t){return[e("pet-image",{attrs:{pet:t.row.petData,equipFaceImg:t.row.equip_face_img,trigger:"hover"}})]}}])}),e("el-table-column",{attrs:{prop:"similarity",label:"相似度",width:"80",sortable:""},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-tag",{attrs:{type:t.getSimilarityTagType(i.row.similarity)}},[t._v(" "+t._s(i.row.similarity)+" ")])]}}])}),e("el-table-column",{attrs:{prop:"level",label:"等级",width:"140"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("p",{class:"是"===i.row.petData.is_baobao?"cBlue":"equip_desc_red"},[e("span",[t._v(t._s("是"===i.row.petData.is_baobao?"":"野生"))]),e("span",[t._v(t._s(i.row.equip_name)+t._s("是"===i.row.petData.is_baobao?"宝宝":"")+"/"+t._s(i.row.level)+"级")])]),e("p",[t._v("参战等级："+t._s(i.row.role_grade_limit)+"级")])]}}])}),e("el-table-column",{attrs:{prop:"growth",label:"成长",width:"60"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",{domProps:{innerHTML:t._s(t.getColorNumber(i.row.growth,[1,1.3]))}})]}}])}),e("el-table-column",{attrs:{prop:"lx",label:"灵性",width:"60"}}),e("el-table-column",{attrs:{prop:"equip_list",label:"装备套装",width:"80"},scopedSlots:t._u([{key:"default",fn:function({row:{equip_list:e}}){return[t._v(" "+t._s(t.getEquipSuitEffect(e))+" ")]}}])}),e("el-table-column",{attrs:{label:"技能/特性",width:"120"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",{staticClass:"special-info"},[e("div",{staticClass:"pet-skills"},[i.row.all_skill?e("span",{staticClass:"skills-text"},[t._v(" "+t._s(t.formatSkillsDiff(i.row.all_skill,t.targetPet))+" ")]):t._e()]),i.row.texing?e("div",{staticClass:"pet-texing"},[e("span",{staticClass:"texing-text"},[t._v(" "+t._s(t.formatTexing(i.row.texing))+" ")])]):t._e()])]}}])}),e("el-table-column",{attrs:{label:"操作",width:"80"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-link",{attrs:{href:t.getCBGLinkByType(i.row.eid,"pet"),type:"danger",target:"_blank"}},[t._v("藏宝阁")])]}}])})],1)},v=[],_=(i(2489),i(7588),i(6175)),y={name:"SimilarPetTable",components:{PetImage:o.A},mixins:[_.G,c.B,l.h],props:{anchors:{type:Array,default:()=>[]},targetPet:{type:Object,default:null}},methods:{getEquipSuitEffect(t){if(!t)return"";try{const e=JSON.parse(t).filter(t=>t),i={};e.forEach(t=>{if(t.desc){const e=t.desc.match(/#c4DBAF4套装效果：附加状态#c4DBAF4([^#]+)/);if(e&&e[1]){const t=e[1].trim();i[t]=(i[t]||0)+1}}});for(const[t,a]of Object.entries(i))return a>=3?t:t+`(${a}/3)`;return""}catch(e){return console.error("解析装备列表失败:",e),""}}}},w=y,$=(0,p.A)(w,g,v,!1,null,"3d8f62dc",null),x=$.exports,b={name:"SimilarPetModal",components:{PetValuation:m,SimilarPetTable:x},mixins:[c.B,l.h],props:{pet:{type:Object,required:!0},placement:{type:String,default:"left-end"},similarityThreshold:{type:Number,default:.8},maxAnchors:{type:Number,default:30}},data(){return{visible:!1,valuationLoading:!1,anchorsLoading:!1,error:!1,similarData:null,petValuation:{}}},computed:{loading(){return this.valuationLoading||this.anchorsLoading}},mounted(){this.$root.$on("search-task-completed",this.handleSearchCompleted)},beforeDestroy(){this.$root.$off("search-task-completed",this.handleSearchCompleted)},methods:{handleSearchCompleted(){this.visible&&this.similarData&&(console.log("检测到搜索任务完成，自动刷新相似召唤兽数据"),this.refresh())},async handleShow(){this.similarData||await this.loadSimilarPets()},async refresh(){await this.loadSimilarPets()},async loadSimilarPets(){this.error=!1,this.petValuation={},this.similarData=null;try{await this.loadPetValuation(this.pet,this.similarityThreshold)}catch(t){console.error("加载相似召唤兽失败:",t),this.error=!0}},async loadPetValuation({petData:t,...e},i){try{this.valuationLoading=!0;const t=await this.$api.pet.getPetValuation({pet_data:e,strategy:"fair_value",similarity_threshold:i,max_anchors:this.maxAnchors}),r=t.data;if(this.petValuation=r,this.$emit("valuation-updated",r),this.similarData={anchor_count:r.anchor_count,similarity_threshold:r.similarity_threshold||i,max_anchors:r.max_anchors||this.maxAnchors,anchors:[],statistics:{price_range:r.anchor_count?{min:Math.min(...r.anchors.map(t=>t.price||0)),max:Math.max(...r.anchors.map(t=>t.price||0)),avg:r.anchors.reduce((t,e)=>t+(e.price||0),0)/r.anchors.length}:{min:0,max:0,avg:0},similarity_range:r.anchor_count?{min:Math.min(...r.anchors.map(t=>t.similarity||0)),max:Math.max(...r.anchors.map(t=>t.similarity||0)),avg:r.anchors.reduce((t,e)=>t+(e.similarity||0),0)/r.anchors.length}:{min:0,max:0,avg:0}}},this.valuationLoading=!1,r?.anchor_count>0&&r?.anchors?.length>0){this.anchorsLoading=!0;try{const t=await this.$api.pet.getPetList({page_size:99,equip_sn_list:r.anchors.map(t=>t.equip_sn)});if(this.anchorsLoading=!1,200===t.code&&t.data?.data){const e=t.data.data,i=e.map((t,e)=>{const i=this.parsePetInfo(t.desc);return t.similarity=r.anchors[e].similarity,t.features=r.anchors[e].features,t.petData=i,t});this.$set(this.similarData,"anchors",i)}else console.warn("未获取到相似召唤兽锚点数据:",t.message)}catch(a){console.error("查询相似召唤兽锚点失败:",a)}}}catch(a){throw console.error("召唤兽估价失败:",a),this.$notify.error({title:"估价请求失败",message:"网络请求异常，请稍后重试",duration:3e3}),a}finally{this.valuationLoading=!1,this.anchorsLoading=!1}}}},S=b,D=(0,p.A)(S,a,r,!1,null,"c328df22",null),C=D.exports}}]);
//# sourceMappingURL=427.7a6c2331.js.map