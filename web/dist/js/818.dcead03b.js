"use strict";(self["webpackChunkweb"]=self["webpackChunkweb"]||[]).push([[818],{818:function(t,e,a){a.r(e),a.d(e,{default:function(){return c}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"user-management"},[e("el-card",{staticClass:"filters",attrs:{shadow:"never"}},[e("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[e("div",[e("span",{staticClass:"emoji-icon"},[t._v("ğŸ‘¥")]),t._v(" ç”¨æˆ·ç®¡ç†")])]),e("el-form",{attrs:{inline:!0,model:t.filters,size:"mini"}},[e("el-form-item",{attrs:{label:"æ¿€æ´»çŠ¶æ€"}},[e("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"å…¨éƒ¨",clearable:""},model:{value:t.filters.is_active,callback:function(e){t.$set(t.filters,"is_active",e)},expression:"filters.is_active"}},[e("el-option",{attrs:{label:"å·²æ¿€æ´»",value:"true"}}),e("el-option",{attrs:{label:"æœªæ¿€æ´»",value:"false"}})],1)],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.fetchUsers}},[t._v("æŸ¥è¯¢")]),e("el-button",{on:{click:t.handleReset}},[t._v("é‡ç½®")])],1)],1)],1),e("el-card",{staticStyle:{"margin-top":"20px"},attrs:{shadow:"never"}},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.users,stripe:"",border:""}},[e("el-table-column",{attrs:{prop:"id",label:"ID",width:"80",align:"center"}}),e("el-table-column",{attrs:{prop:"username",label:"æ‰‹æœºå·",width:"130",align:"center"}}),e("el-table-column",{attrs:{prop:"email",label:"é‚®ç®±",width:"180","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"is_active",label:"æ¿€æ´»çŠ¶æ€",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{attrs:{type:a.row.is_active?"success":"info",size:"mini"}},[t._v(" "+t._s(a.row.is_active?"å·²æ¿€æ´»":"æœªæ¿€æ´»")+" ")])]}}])}),e("el-table-column",{attrs:{prop:"is_premium",label:"é«˜çº§ç”¨æˆ·",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{attrs:{type:a.row.is_premium?"warning":"",size:"mini"}},[t._v(" "+t._s(a.row.is_premium?"æ˜¯":"å¦")+" ")])]}}])}),e("el-table-column",{attrs:{prop:"fingerprint",label:"Fingerprint",width:"200","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.fingerprint?e("span",{staticStyle:{"font-family":"monospace","font-size":"12px"}},[t._v(" "+t._s(a.row.fingerprint.substring(0,20))+"... ")]):e("span",{staticStyle:{color:"#909399"}},[t._v("æœªç»‘å®š")])]}}])}),e("el-table-column",{attrs:{prop:"created_at",label:"æ³¨å†Œæ—¶é—´",width:"180",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.formatDateTime(e.row.created_at))+" ")]}}])}),e("el-table-column",{attrs:{prop:"last_login_at",label:"æœ€åç™»å½•",width:"180",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.last_login_at?t.formatDateTime(e.row.last_login_at):"ä»æœªç™»å½•")+" ")]}}])}),e("el-table-column",{attrs:{prop:"token_expires_at",label:"Tokenè¿‡æœŸ",width:"180",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.token_expires_at?e("span",[t._v(" "+t._s(t.formatDateTime(a.row.token_expires_at))+" ")]):e("span",{staticStyle:{color:"#909399"}},[t._v("æ— ")])]}}])}),e("el-table-column",{attrs:{label:"æ“ä½œ",width:"280",fixed:"right",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.is_active?e("el-button",{attrs:{type:"warning",size:"mini",loading:a.row.deactivating},on:{click:function(e){return t.handleDeactivate(a.row)}}},[t._v(" ç¦ç”¨ ")]):e("el-button",{attrs:{type:"success",size:"mini",loading:a.row.activating},on:{click:function(e){return t.handleActivate(a.row)}}},[t._v(" æ¿€æ´» ")]),a.row.is_premium?e("el-button",{attrs:{type:"info",size:"mini",loading:a.row.settingPremium},on:{click:function(e){return t.handleSetPremium(a.row,!1)}}},[t._v(" å–æ¶ˆé«˜çº§ ")]):e("el-button",{attrs:{type:"primary",size:"mini",loading:a.row.settingPremium},on:{click:function(e){return t.handleSetPremium(a.row,!0)}}},[t._v(" è®¾ä¸ºé«˜çº§ ")])]}}])})],1),e("el-pagination",{staticStyle:{"margin-top":"20px","text-align":"right"},attrs:{"current-page":t.pagination.page,"page-sizes":[10,20,50,100],"page-size":t.pagination.page_size,layout:"total, sizes, prev, pager, next, jumper",total:t.pagination.total},on:{"size-change":t.handleSizeChange,"current-change":t.handlePageChange}})],1)],1)},s=[],n={name:"UserManagement",data(){return{loading:!1,users:[],filters:{is_active:null},pagination:{page:1,page_size:20,total:0,pages:0}}},mounted(){this.fetchUsers()},methods:{async fetchUsers(){this.loading=!0;try{const t={page:this.pagination.page,page_size:this.pagination.page_size};null!==this.filters.is_active&&""!==this.filters.is_active&&(t.is_active=String(this.filters.is_active));const e=await this.$api.admin.getUserList(t);if(200===e.code){const t=e.data;this.users=t.users||[],this.pagination.total=t.total||0,this.pagination.pages=t.pages||0}else this.$message.error(e.message||"è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥")}catch(t){console.error("è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥:",t),this.$message.error("è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥")}finally{this.loading=!1}},async handleActivate(t){this.$set(t,"activating",!0);try{const e=await this.$api.admin.activateUser(t.id);200===e.code?(this.$message.success("ç”¨æˆ·æ¿€æ´»æˆåŠŸ"),t.is_active=!0,this.fetchUsers()):this.$message.error(e.message||"æ¿€æ´»å¤±è´¥")}catch(e){console.error("æ¿€æ´»ç”¨æˆ·å¤±è´¥:",e),this.$message.error("æ¿€æ´»ç”¨æˆ·å¤±è´¥")}finally{this.$set(t,"activating",!1)}},async handleDeactivate(t){this.$confirm("ç¡®å®šè¦ç¦ç”¨è¯¥ç”¨æˆ·å—ï¼Ÿç¦ç”¨åç”¨æˆ·å°†æ— æ³•ç™»å½•ã€‚","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}).then(async()=>{this.$set(t,"deactivating",!0);try{const e=await this.$api.admin.deactivateUser(t.id);200===e.code?(this.$message.success("ç”¨æˆ·å·²ç¦ç”¨"),t.is_active=!1,this.fetchUsers()):this.$message.error(e.message||"ç¦ç”¨å¤±è´¥")}catch(e){console.error("ç¦ç”¨ç”¨æˆ·å¤±è´¥:",e),this.$message.error("ç¦ç”¨ç”¨æˆ·å¤±è´¥")}finally{this.$set(t,"deactivating",!1)}}).catch(()=>{})},async handleSetPremium(t,e){this.$set(t,"settingPremium",!0);try{const a=await this.$api.admin.setPremium(t.id,e);200===a.code?(this.$message.success(a.message||(e?"å·²è®¾ç½®ä¸ºé«˜çº§ç”¨æˆ·":"å·²å–æ¶ˆé«˜çº§ç”¨æˆ·")),t.is_premium=e,this.fetchUsers()):this.$message.error(a.message||"æ“ä½œå¤±è´¥")}catch(a){console.error("è®¾ç½®é«˜çº§ç”¨æˆ·å¤±è´¥:",a),this.$message.error("æ“ä½œå¤±è´¥")}finally{this.$set(t,"settingPremium",!1)}},handleReset(){this.filters={is_active:null},this.pagination.page=1,this.fetchUsers()},handleSizeChange(t){this.pagination.page_size=t,this.pagination.page=1,this.fetchUsers()},handlePageChange(t){this.pagination.page=t,this.fetchUsers()},formatDateTime(t){if(!t)return"-";try{const e=new Date(t),a=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0"),l=String(e.getSeconds()).padStart(2,"0");return`${a}-${i}-${s} ${n}:${r}:${l}`}catch(e){return t}}}},r=n,l=a(1656),o=(0,l.A)(r,i,s,!1,null,"686a1b00",null),c=o.exports}}]);
//# sourceMappingURL=818.dcead03b.js.map