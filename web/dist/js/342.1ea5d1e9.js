"use strict";(self["webpackChunkweb"]=self["webpackChunkweb"]||[]).push([[342],{2740:function(e,t,i){i.r(t),i.d(t,{default:function(){return y}});var a=function(){var e=this,t=e._self._c;return t("div",[t("el-card",{staticClass:"spider-config-card",staticStyle:{"margin-bottom":"10px"},attrs:{shadow:"never"}},[t("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[t("div",[t("span",{staticClass:"emoji-icon"},[e._v("🎯")]),e._v(" 模拟目标装备")])]),t("el-row",{staticStyle:{"margin-bottom":"10px"},attrs:{type:"flex",align:"top"}},[t("el-row",{staticClass:"simulate-wrapper",staticStyle:{"flex-shrink":"0"},attrs:{type:"flex",justify:"space-between"}},[t("el-col",{staticStyle:{width:"120px","margin-right":"20px"}},[t("el-image",{staticStyle:{width:"120px",height:"120px"},attrs:{src:e.getImageUrl(e.equipment.equip_face_img,"big"),fit:"cover",referrerpolicy:"no-referrer"}})],1),t("el-col",[e.equipment.equip_name?t("p",{staticClass:"equip_desc_yellow"},[e._v(e._s(e.equipment.equip_name))]):e._e(),t("p",{domProps:{innerHTML:e._s(e.parseEquipDesc(e.equipment.equip_type_desc?.replace(/#R/g,"<br />"),"#n"))}}),t("p",{domProps:{innerHTML:e._s(e.parseEquipDesc(e.equipment.large_equip_desc))}})])],1),t("div",{staticStyle:{"margin-left":"10px",width:"60px","flex-shrink":"0"}},[t("el-button",{staticStyle:{"margin-bottom":"10px"},attrs:{type:"success",size:"mini"},on:{click:e.takeSnapshot}},[e._v("拍照")]),t("br"),t("SimilarEquipmentModal",{attrs:{equipment:{...e.equipmentValuation,...e.equipment},"similar-data":e.similarEquipments,placement:"left-start"},on:{show:e.loadSimilarEquipments}},[t("el-button",{attrs:{type:"primary",size:"mini"}},[e._v("估价")])],1)],1),t("div",{staticStyle:{"margin-left":"10px",height:"300px","overflow-y":"auto",width:"100%"}},[t("el-tabs",{attrs:{value:"first"}},[t("el-tab-pane",{attrs:{label:"快照列表",name:"first"}},[0===e.snapshots.length?t("div",{staticStyle:{color:"#999","text-align":"center",padding:"20px"}},[e._v(" 暂无快照，点击拍照按钮创建快照 ")]):t("div",e._l(e.snapshots,function(i){return t("div",{key:i.id,staticStyle:{"margin-bottom":"10px"}},[t("el-tag",{staticStyle:{cursor:"pointer","margin-right":"5px"},attrs:{type:"success",closable:""},on:{click:function(t){return e.showSnapshotDetail(i)},close:function(t){return e.deleteSnapshot(i.id)}}},[e._v(" "+e._s(i.name)+" ")])],1)}),0)]),t("el-tab-pane",{attrs:{label:"异常数据",name:"second"}},[t("div",{staticClass:"abnormal-data-container"},[t("el-row",{staticClass:"abnormal-toolbar"},[t("el-select",{staticStyle:{width:"120px","margin-right":"10px"},attrs:{placeholder:"状态筛选",size:"mini"},model:{value:e.abnormalStatusFilter,callback:function(t){e.abnormalStatusFilter=t},expression:"abnormalStatusFilter"}},[t("el-option",{attrs:{label:"全部",value:""}}),t("el-option",{attrs:{label:"待处理",value:"pending"}}),t("el-option",{attrs:{label:"已解决",value:"resolved"}}),t("el-option",{attrs:{label:"已忽略",value:"ignored"}}),t("el-option",{attrs:{label:"调查中",value:"investigating"}})],1),t("el-button",{attrs:{type:"primary",size:"mini",loading:e.loadingAbnormal},on:{click:e.loadAbnormalData}},[t("i",{staticClass:"el-icon-refresh"}),e._v(" 刷新 ")]),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"danger",size:"mini"},on:{click:e.clearAllAbnormal}},[t("i",{staticClass:"el-icon-delete"}),e._v(" 清空所有 ")]),e.abnormalTotal>0?t("div",{staticClass:"abnormal-pagination"},[t("el-pagination",{attrs:{"current-page":e.abnormalPage,"page-size":e.abnormalPageSize,total:e.abnormalTotal,layout:"total, prev, pager, next",small:""},on:{"current-change":e.handleAbnormalPageChange}})],1):e._e()],1),0===e.abnormalEquipments.length?t("el-empty",{attrs:{description:"暂无数据"}}):t("el-row",{staticClass:"abnormal-list",staticStyle:{"flex-wrap":"wrap"},attrs:{type:"flex"}},e._l(e.abnormalEquipments,function(i){return t("el-card",{key:i.id,staticClass:"abnormal-item",attrs:{shadow:"hover"}},[t("div",{staticClass:"abnormal-header"},[t("div",{staticClass:"equipment-info"},[t("EquipmentImage",{attrs:{equipment:i.equipment_data}}),t("div",{staticStyle:{"margin-left":"10px"}},[t("SimilarEquipmentModal",{attrs:{equipment:{...e.equipmentValuation,...i.equipment_data},"similar-data":e.similarEquipments,valuation:e.equipmentValuation,placement:"left-start"},on:{show:e.loadSimilarEquipments}},[t("el-link",{staticClass:"equipment-name",attrs:{href:"javascript:void(0);"}},[e._v(e._s(i.equipment_data.equip_name||"未知装备"))])],1),t("p",{staticClass:"equipment-sn"},[e._v("序列号: "+e._s(i.equip_sn))])],1)],1),t("div",{staticClass:"abnormal-actions"},[t("el-tag",{attrs:{type:e.getStatusTagType(i.status),size:"mini"}},[e._v(e._s(e.getStatusText(i.status)))]),t("el-dropdown",{staticStyle:{"margin-left":"10px"},attrs:{trigger:"click"},on:{command:e.handleAbnormalAction}},[t("el-button",{attrs:{type:"text",size:"mini"}},[t("i",{staticClass:"el-icon-more"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:`view_${i.equip_sn}`}},[e._v("查看详情")]),t("el-dropdown-item",{attrs:{command:`edit_${i.equip_sn}`}},[e._v("编辑状态")]),t("el-dropdown-item",{attrs:{command:`delete_${i.equip_sn}`,divided:""}},[e._v("删除记录")])],1)],1)],1)]),t("div",{staticClass:"abnormal-content"},[t("div",{staticClass:"abnormal-details"},[t("p",[t("strong",[e._v("标记原因:")]),e._v(" "+e._s(i.mark_reason))]),i.notes?t("p",[t("strong",[e._v("备注:")]),e._v(" "+e._s(i.notes))]):e._e(),t("p",[t("strong",[e._v("标记时间:")]),e._v(" "+e._s(e.formatTime(i.mark_time)))])])])])}),1)],1)])],1)],1)],1)],1),t("el-card",{staticClass:"spider-config-card",attrs:{shadow:"never"}},[t("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[t("div",[t("span",{staticClass:"emoji-icon"},[e._v("⚙️")]),e._v(" 配置")])]),t("el-form",{attrs:{inline:""}},[t("el-form-item",{attrs:{label:"装备类型"}},[t("el-select",{attrs:{placeholder:"请选择",filterable:""},model:{value:e.iType,callback:function(t){e.iType=t},expression:"iType"}},e._l(e.filteredEquipInfo,function([i,a]){return t("el-option",{key:i,attrs:{label:a.name,value:i}},[t("div",{staticStyle:{width:"400px","background-color":"#2c3e50 !important",display:"flex","align-items":"center"}},[t("el-image",{staticStyle:{width:"34px",height:"34px",display:"block","flex-shrink":"0"},attrs:{src:e.getImageUrl(i+".gif","big"),fit:"cover",referrerpolicy:"no-referrer"}}),t("p",{staticClass:"equip_desc_yellow",staticStyle:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","padding-left":"5px"}},[e._v(" "+e._s(a.name)+"-"),t("span",{staticStyle:{color:"#fff","font-size":"12px"}},[e._v(e._s(a.desc))])])],1)])}),1)],1),t("div",[t("el-form-item",{attrs:{label:"等级"}},[t("el-input-number",{attrs:{min:0,max:200,step:5},model:{value:e.level,callback:function(t){e.level=t},expression:"level"}})],1),t("el-form-item",{attrs:{label:"五行"}},[t("el-select",{attrs:{placeholder:"请选择五行"},model:{value:e.wu_xing,callback:function(t){e.wu_xing=t},expression:"wu_xing"}},[t("el-option",{attrs:{label:"金",value:"金"}}),t("el-option",{attrs:{label:"木",value:"木"}}),t("el-option",{attrs:{label:"水",value:"水"}}),t("el-option",{attrs:{label:"火",value:"火"}}),t("el-option",{attrs:{label:"土",value:"土"}})],1)],1)],1),t("el-form-item",{attrs:{label:"耐久度"}},[t("el-input-number",{attrs:{min:0,max:1e3,step:100},model:{value:e.naijiu,callback:function(t){e.naijiu=t},expression:"naijiu"}})],1),t("el-form-item",{attrs:{label:"修理失败次数"}},[t("el-input-number",{attrs:{min:0,max:3,step:1},model:{value:e.repair_fail,callback:function(t){e.repair_fail=t},expression:"repair_fail"}})],1),t("el-form-item",[t("template",{slot:"label"},[e._v(" 属性 "),t("el-button",{attrs:{type:"text"},on:{click:e.clearAttrs}},[e._v("清空属性")])],1),e._l(e.addonOptions,function(i){return t("el-form-item",{key:i[0],attrs:{label:i[1]}},[t("el-input-number",{attrs:{"controls-position":"right"},model:{value:e.addon[i[0]],callback:function(t){e.$set(e.addon,i[0],t)},expression:"addon[item[0]]"}})],1)})],2),t("div",[t("el-form-item",{attrs:{label:"锻炼等级"}},[t("el-input-number",{attrs:{min:0,max:100,step:1},model:{value:e.gemLevel,callback:function(t){e.gemLevel=t},expression:"gemLevel"}})],1),t("el-form-item",{attrs:{label:"镶嵌宝石"}},[t("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"镶嵌宝石",clearable:"",filterable:"",multiple:""},model:{value:e.gemType,callback:function(t){e.gemType=t},expression:"gemType"}},e._l(e.gems_name,function(i,a){return t("el-option",{key:a,attrs:{value:i,label:i}},[t("el-row",{attrs:{type:"flex",justify:"space-between"}},[t("el-col",{staticStyle:{width:"34px",height:"34px","margin-right":"10px"}},[t("el-image",{staticStyle:{width:"34px",height:"34px",cursor:"pointer"},attrs:{src:e.getImageUrl(e.gem_image[a]+".gif"),fit:"cover",referrerpolicy:"no-referrer"}})],1),t("el-col",{staticStyle:{width:"100px"}},[e._v(" "+e._s(i)+" ")])],1)],1)}),1)],1)],1),e.is_lingshi_equip?t("div",e._l(e.attrs_list,function(i,a){return t("div",{key:a},[t("el-form-item",{attrs:{label:"属性"}},[t("el-select",{attrs:{placeholder:"请选择属性",clearable:""},on:{change:t=>e.changeAttrTypeRange(t,a)},model:{value:e.attrs_list[a].attr_type,callback:function(t){e.$set(e.attrs_list[a],"attr_type",t)},expression:"attrs_list[index].attr_type"}},e._l(e.currentLevelLingshiConfig,function(e,i,a){return t("el-option",{key:a,attrs:{label:i,value:i,"data-range":JSON.stringify(e)}})}),1)],1),t("el-form-item",{attrs:{label:"属性值"}},[t("el-input-number",{attrs:{min:e.attrs_list[a].range[0],max:e.attrs_list[a].range[1],step:1},model:{value:e.attrs_list[a].attr_value,callback:function(t){e.$set(e.attrs_list[a],"attr_value",t)},expression:"attrs_list[index].attr_value"}})],1)],1)}),0):[t("el-form-item",{attrs:{label:"特技"}},[t("el-select",{attrs:{placeholder:"请选择特技",clearable:"",filterable:""},model:{value:e.special_skill,callback:function(t){e.special_skill=t},expression:"special_skill"}},e._l(e.equip_special_skills,function([e,i]){return t("el-option",{key:e,attrs:{label:i,value:i}})}),1)],1),t("br")],t("el-form-item",{attrs:{label:"特效"}},[t("el-select",{attrs:{placeholder:"请选择特效",multiple:"",clearable:"",filterable:""},model:{value:e.special_effect,callback:function(t){e.special_effect=t},expression:"special_effect"}},e._l(e.equip_special_effect,function(e,i){return t("el-option",{key:i,attrs:{label:"1"===i?e+"/超级简易":e,value:e}})}),1)],1),t("br"),e.is_lingshi_equip?e._e():[t("el-form-item",{attrs:{label:"套装"}},[t("el-cascader",{attrs:{options:e.suitOptions,placeholder:"请选择套装效果",separator:"",clearable:"",filterable:""},on:{change:e.handleSuitChange}})],1),t("br"),t("el-form-item",{attrs:{label:"开运孔数"}},[t("el-input-number",{attrs:{min:0,max:10,step:1},model:{value:e.kaiyun_num,callback:function(t){e.kaiyun_num=t},expression:"kaiyun_num"}}),e._v(" 双开运孔:"),t("el-switch",{model:{value:e.isDoubleKaiyun,callback:function(t){e.isDoubleKaiyun=t},expression:"isDoubleKaiyun"}})],1),t("el-form-item",{attrs:{label:"熔炼"}},e._l(e.filteredRonglianOptions,function(i){return t("el-form-item",{key:i[0],attrs:{label:i[1]}},[t("el-input-number",{attrs:{"controls-position":"right"},model:{value:e.ronglian_addon[i[0]],callback:function(t){e.$set(e.ronglian_addon,i[0],t)},expression:"ronglian_addon[item[0]]"}})],1)}),1)]],2)],1),t("el-dialog",{attrs:{title:"快照详情",visible:e.snapshotDialogVisible,width:"600px","before-close":()=>{e.snapshotDialogVisible=!1,e.currentSnapshot=null}},on:{"update:visible":function(t){e.snapshotDialogVisible=t}}},[e.currentSnapshot?t("div",{staticClass:"snapshot-detail"},[t("div",{staticClass:"snapshot-header"},[t("h3",[e._v(e._s(e.currentSnapshot.name))]),t("p",{staticClass:"snapshot-time"},[e._v("创建时间："+e._s(new Date(e.currentSnapshot.timestamp).toLocaleString()))])]),t("div",{staticClass:"equipment-preview"},[t("el-row",{attrs:{type:"flex",align:"top"}},[t("el-col",{staticStyle:{width:"120px","margin-right":"20px"}},[t("el-image",{staticStyle:{width:"120px",height:"120px"},attrs:{src:e.getImageUrl(e.currentSnapshot.equipment.equip_face_img,"big"),fit:"cover",referrerpolicy:"no-referrer"}})],1),t("el-col",[e.currentSnapshot.equipment.equip_name?t("p",{staticClass:"equip_desc_yellow"},[e._v(" "+e._s(e.currentSnapshot.equipment.equip_name)+" ")]):e._e(),t("p",{domProps:{innerHTML:e._s(e.parseEquipDesc(e.currentSnapshot.equipment.equip_type_desc?.replace(/#R/g,"<br />"),"#n"))}}),t("p",{domProps:{innerHTML:e._s(e.parseEquipDesc(e.currentSnapshot.equipment.large_equip_desc))}})])],1)],1)]):e._e(),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.snapshotDialogVisible=!1}}},[e._v("关闭")]),t("el-button",{attrs:{type:"primary"},on:{click:e.restoreSnapshot}},[e._v("恢复此快照")])],1)]),t("AbnormalStatusEditDialog",{attrs:{visible:e.statusEditDialogVisible,"equip-sn":e.currentEditEquipSn,"current-status":e.currentEditStatus},on:{success:e.handleStatusEditSuccess,close:e.handleStatusEditClose}})],1)},s=[],n=(i(4114),i(8111),i(2489),i(116),i(7588),i(1701),i(8237),i(8770)),l=i(7548),r=i(3016),o=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"编辑异常状态",visible:e.visible,width:"400px","before-close":e.handleClose},on:{close:e.handleClose}},[t("div",{staticClass:"status-edit-form"},[t("el-form",{attrs:{model:e.form,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"当前状态"}},[t("el-tag",{attrs:{type:e.getStatusTagType(e.currentStatus)}},[e._v(" "+e._s(e.getStatusText(e.currentStatus))+" ")])],1),t("el-form-item",{attrs:{label:"新状态",required:""}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择新状态"},model:{value:e.form.newStatus,callback:function(t){e.$set(e.form,"newStatus",t)},expression:"form.newStatus"}},[t("el-option",{attrs:{label:"待处理",value:"pending"}}),t("el-option",{attrs:{label:"已解决",value:"resolved"}}),t("el-option",{attrs:{label:"已忽略",value:"ignored"}}),t("el-option",{attrs:{label:"调查中",value:"investigating"}})],1)],1),t("el-form-item",{attrs:{label:"备注"}},[t("el-input",{attrs:{type:"textarea",rows:3,placeholder:"可选：添加状态变更备注"},model:{value:e.form.notes,callback:function(t){e.$set(e.form,"notes",t)},expression:"form.notes"}})],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v("取消")]),t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.handleConfirm}},[e._v(" 确定 ")])],1)])},u=[],p={name:"AbnormalStatusEditDialog",props:{visible:{type:Boolean,default:!1},equipSn:{type:String,default:""},currentStatus:{type:String,default:"pending"}},data(){return{form:{newStatus:"",notes:""},loading:!1}},watch:{visible(e){e&&(this.form.newStatus=this.currentStatus,this.form.notes="")}},methods:{handleClose(){this.$emit("close"),this.resetForm()},resetForm(){this.form.newStatus="",this.form.notes="",this.loading=!1},async handleConfirm(){if(this.form.newStatus){this.loading=!0;try{await this.$api.equipment.updateAbnormalEquipmentStatus(this.equipSn,{status:this.form.newStatus,notes:this.form.notes}),this.$notify.success({title:"提示",message:`异常状态已更新为: ${this.getStatusText(this.form.newStatus)}`}),this.$emit("success",{equipSn:this.equipSn,newStatus:this.form.newStatus,notes:this.form.notes}),this.$emit("close"),this.resetForm()}catch(e){console.error("更新状态失败:",e),this.$notify.error({title:"提示",message:"更新状态失败"})}finally{this.loading=!1}}else this.$notify.warning({title:"提示",message:"请选择新状态"})},getStatusTagType(e){switch(e){case"pending":return"warning";case"resolved":return"success";case"ignored":return"info";case"investigating":return"danger";default:return"info"}},getStatusText(e){switch(e){case"pending":return"待处理";case"resolved":return"已解决";case"ignored":return"已忽略";case"investigating":return"调查中";default:return"未知"}}}},c=p,h=i(1656),d=(0,h.A)(c,o,u,!1,null,"69911252",null),m=d.exports;const _=[];if(window.AUTO_SEARCH_CONFIG){if(window.AUTO_SEARCH_CONFIG.suit_added_status){const e=Object.entries(window.AUTO_SEARCH_CONFIG.suit_added_status).map(([,e])=>({value:`附加状态${e}`,label:e}));e.length>0&&_.push({value:"附加状态",label:"附加状态",children:e})}if(window.AUTO_SEARCH_CONFIG.suit_effects){const e=Object.entries(window.AUTO_SEARCH_CONFIG.suit_effects).map(([,e])=>({value:`追加法术${e}`,label:e}));e.length>0&&_.push({value:"追加法术",label:"追加法术",children:e})}if(window.AUTO_SEARCH_CONFIG.suit_transform_skills){const e=Object.entries(window.AUTO_SEARCH_CONFIG.suit_transform_skills).map(([,e])=>({value:`变身术之${e}`,label:e}));e.length>0&&_.push({value:"变身术之",label:"变身术之",children:e})}if(window.AUTO_SEARCH_CONFIG.suit_transform_charms){const e=Object.entries(window.AUTO_SEARCH_CONFIG.suit_transform_charms).map(([,e])=>({value:`变化咒之${e}`,label:e}));e.length>0&&_.push({value:"变化咒之",label:"变化咒之",children:e})}}var g={name:"EquipmentDescCreator",components:{SimilarEquipmentModal:l.A,EquipmentImage:r.A,AbnormalStatusEditDialog:m},mixins:[n.B],data(){return{suitOptions:_,storageKey:"equipment_desc_creator_data",snapshotStorageKey:"equipment_snapshots",snapshots:[],snapshotDialogVisible:!1,currentSnapshot:null,lingshiPerGemAdd:{"伤害":4,"法术伤害结果":3,"物理暴击等级":4,"固定伤害":4,"封印命中等级":4,"抗法术暴击等级":8,"抗物理暴击等级":8,"抵抗封印等级":8,"格挡值":8,"气血":28,"气血回复效果":4,"治疗能力":3,"法术伤害":4,"法术暴击等级":4,"法术防御":8,"狂暴等级":3,"穿刺等级":4,"速度":3,"防御":8},lingshiConfig:{},similarEquipments:null,equipmentValuation:{},equip_info:window.CBG_GAME_CONFIG.equip_info,equip_special_skills:window.AUTO_SEARCH_CONFIG.equip_special_skills,equip_special_effect:window.AUTO_SEARCH_CONFIG.equip_special_effect,iType:"1007",level:0,wu_xing:"土",naijiu:500,repair_fail:0,gemLevel:0,suit_effect:"",gemType:[],special_skill:"",special_effect:[],creator:"榄核小华为你",kaiyun_num:0,isDoubleKaiyun:!1,attrs_list:[{attr_type:"",attr_value:0,range:[0,0]},{attr_type:"",attr_value:0,range:[0,0]},{attr_type:"",attr_value:0,range:[0,0]}],addon:{tizhi:0,naili:0,moli:0,minjie:0,liliang:0,wakan:0,magic_damage:0,magic_defence:0,mofa:0,mingzhong:0,shanghai:0,speed:0,defence:0,hp:0,fengyin:0,anti_fengyin:0},ronglian_addon:{tizhi:0,naili:0,moli:0,minjie:0,liliang:0,defence:0,hp:0,wakan:0,magic_defence:0,mofa:0},addonOptions:[["shanghai","伤害"],["mingzhong","命中"],["defence","防御"],["hp","气血"],["speed","速度"],["wakan","灵力"],["tizhi","体质"],["moli","魔力"],["liliang","力量"],["naili","耐力"],["minjie","敏捷"],["magic_damage","法术伤害"],["magic_defence","法防"],["mofa","魔法"],["fengyin","封印命中等级"],["anti_fengyin","抵抗封印等级"]],features:{},currentKindid:0,gems_name:window.AUTO_SEARCH_CONFIG.gems_name,gem_image:{1:"4011",2:"4002",3:"4012",4:"4004",5:"4003",6:"4010",7:"4005",8:"4007",9:"4006",10:"4008",11:"4009",12:"1108_4249",4244:"4244","755_4036":"755_4036","756_4037":"756_4037","757_4038":"757_4038"},abnormalEquipments:[],abnormalPage:1,abnormalPageSize:10,abnormalTotal:0,abnormalStatusFilter:"",loadingAbnormal:!1,statusEditDialogVisible:!1,currentEditEquipSn:"",currentEditStatus:""}},computed:{filteredEquipInfo(){return Object.entries(this.equip_info).filter(([,e])=>{const t=e.desc.match(/等级\s*(\d+)/);let i=60;return t&&(i=parseInt(t[1])),e.desc&&-1!==e.desc.indexOf("等级")&&-1===e.desc.indexOf("召唤兽")&&i>=60})},filteredRonglianOptions(){return this.addonOptions.filter(e=>void 0!==this.ronglian_addon[e[0]])},currentLevelLingshiConfig(){return this.lingshiConfig[this.level]?.attrs||this.lingshiConfig["60"]?.attrs||{}},is_lingshi_equip(){return window.is_lingshi_equip(this.currentKindid)},is_shoes_equip(){return window.is_shoes_equip(this.currentKindid)},is_belt_equip(){return window.is_belt_equip(this.currentKindid)},is_necklace_equip(){return window.is_necklace_equip(this.currentKindid)},is_helmet_equip(){return window.is_helmet_equip(this.currentKindid)},is_weapon_equip(){return window.is_weapon_equip(this.currentKindid)},is_cloth_equip(){return window.is_cloth_equip(this.currentKindid)},equip_params(){return{type:1*this.iType,large_equip_desc:this.large_equip_desc}},equip_desc(){const e=this.equip_info[this.iType];return e?{equip_name:e.name,equip_type_desc:e.desc}:{equip_name:"",equip_type_desc:""}},equip_face_img(){return this.iType+".gif"},equipment(){return{cDesc:this.large_equip_desc,iType:1*this.iType,large_equip_desc:this.large_equip_desc,equip_face_img:this.equip_face_img,...this.equip_desc}},large_equip_desc(){let e="",t=[""];if(this.is_lingshi_equip){const i=`等级 ${this.level}`;e+=i;let a="";const s=this.addonOptions.find(([e])=>(61!==this.currentKindid||"shanghai"!==e&&"defence"!==e)&&(62!==this.currentKindid||"magic_damage"!==e&&"magic_defence"!==e)&&(63!==this.currentKindid||"fengyin"!==e&&"anti_fengyin"!==e)?64===this.currentKindid&&"speed"===e&&this.addon[e]>0:this.addon[e]>0);if(s){let t=s[1];"法防"===t&&(t="法术防御"),a=`${t} +${this.addon[s[0]]}`,e+="#r"+a}let n=`耐久度 ${this.naijiu}`;if(this.repair_fail>0&&(n+=` 修理失败 ${this.repair_fail}次`),e+="#r"+n,t.push(n),this.special_effect.length>0){let i="#c4DBAF4特效：";this.special_effect.forEach((e,t)=>{t>0&&(i+=" "),"无级别"===e&&(e+="超级简易"),i+=`#c4DBAF4${e}#Y`}),e+="#r"+i,t.push(i)}if(this.gemLevel>0){const i=`精炼等级 ${this.gemLevel}`;e+="#r"+i,t.push(i)}this.attrs_list.forEach(i=>{if(i.attr_type){let a=`#G${i.attr_type} +${i.attr_value}`;if(this.gemLevel>0){const e=(this.lingshiPerGemAdd[i.attr_type]||0)*this.gemLevel;a+=` #cEE82EE[+${e}]`}e+="#r"+a,t.push(a)}});const l=`#W制造者：${this.creator}强化打造#`;e+="#r"+l,t.push(l)}else{let i=`等级 ${this.level}`;if((this.is_weapon_equip||this.is_cloth_equip||this.is_shoes_equip)&&(i+=`  五行 ${this.wu_xing}`),e+="#r"+i,t.push(i),this.is_weapon_equip){const i=`命中 ${this.addon.mingzhong} 伤害 ${this.addon.shanghai}`;e+="#r"+i,t.push(i)}if(this.is_cloth_equip||this.is_helmet_equip||this.is_belt_equip||this.is_shoes_equip||this.is_helmet_equip){const i=`防御 +${this.addon.defence}`;e+="#r"+i,t.push(i)}if(this.is_helmet_equip){const i=` 魔法 +${this.addon.mofa}`;e+=i;const a=t.pop();t.push(a+i)}if(this.is_belt_equip||this.is_cloth_equip){const i=` 气血 +${this.addon.hp}`;e+=i;const a=t.pop();t.push(a+i)}if(this.is_shoes_equip){const i=` 敏捷 +${this.addon.minjie}`;e+=i;const a=t.pop();t.push(a+i)}if(this.is_necklace_equip){const i=`灵力 +${this.addon.wakan}`;e+="#r"+i,t.push(i)}let a=`耐久度 ${this.naijiu}`;if(this.repair_fail>0&&(a+=` 修理失败 ${this.repair_fail}次`),e+="#r"+a,t.push(a),this.gemLevel>0){const i=`锻炼等级 ${this.gemLevel}  镶嵌宝石 ${this.gemType.join("、 ")}`;e+="#r"+i,t.push(i)}let s="#G";if(this.addonOptions.filter(([e])=>(!this.is_weapon_equip||"shanghai"!==e&&"mingzhong"!==e)&&((!this.is_necklace_equip||"wakan"!==e)&&((!this.is_helmet_equip||"defence"!==e&&"mofa"!==e)&&((!this.is_belt_equip||"defence"!==e&&"hp"!==e)&&((!this.is_shoes_equip||"minjie"!==e&&"defence"!==e)&&((!this.is_cloth_equip||"hp"!==e&&"defence"!==e)&&(0!==this.addon[e]&&void 0!==this.addon[e]||void 0))))))).forEach(([e,t],i)=>{i>0&&(s+=" "),s+=`#G${t} ${this.addon[e]>0?`+${this.addon[e]}`:this.addon[e]}#Y`}),e+="#r"+s,t.push(s),this.special_skill){const i=`#c4DBAF4特技：#c4DBAF4${this.special_skill}#Y#Y`;e+="#r"+i,t.push(i)}if(this.special_effect.length>0){let i="#c4DBAF4特效：";this.special_effect.forEach((e,t)=>{t>0&&(i+=" "),"无级别"===e&&(e+="限制"),i+=`#c4DBAF4${e}#Y`}),e+="#r"+i,t.push(i)}if(this.suit_effect){let i=`#c4DBAF4套装效果：${this.suit_effect}#Y#Y`;e+="#r"+i,t.push(i)}if(this.kaiyun_num>0){let i=`#G开运孔数：${this.kaiyun_num}孔/${this.kaiyun_num}孔#G`;this.isDoubleKaiyun&&(i+=` (双${this.kaiyun_num}孔)`),e+="#r"+i,t.push(i)}const n=`#W制造者：${this.creator}强化打造#Y`;e+="#r"+n,t.push(n);let l="";const r=[];for(let e in this.ronglian_addon)0!==this.ronglian_addon[e]&&void 0!==this.ronglian_addon[e]&&r.push(`${this.ronglian_addon[e]>0?`+${this.ronglian_addon[e]}`:this.ronglian_addon[e]}${this.addonOptions.find(t=>t[0]===e)[1]}`);r.forEach((e,t)=>{t>0&&(l+=" "),t%2===0&&(l+="#r"),l+=e}),r.length>0&&(l=`#Y熔炼效果：#r#Y${l}#Y`,e+="#r"+l,t.push(l))}return console.log(e,"desc"),console.log(t.join("#r"),"descList.join('#r')"),console.log(e===t.join("#r")),e}},watch:{iType:{handler:"saveToLocalStorage",deep:!0},level:{handler:"saveToLocalStorage",deep:!0},wu_xing:{handler:"saveToLocalStorage",deep:!0},naijiu:{handler:"saveToLocalStorage",deep:!0},repair_fail:{handler:"saveToLocalStorage",deep:!0},gemLevel:{handler:"saveToLocalStorage",deep:!0},gemType:{handler:"saveToLocalStorage",deep:!0},special_skill:{handler:"saveToLocalStorage",deep:!0},suit_effect:{handler:"saveToLocalStorage",deep:!0},special_effect:{handler:"saveToLocalStorage",deep:!0},kaiyun_num:{handler:"saveToLocalStorage",deep:!0},isDoubleKaiyun:{handler:"saveToLocalStorage",deep:!0},attrs_list:{handler:"saveToLocalStorage",deep:!0},addon:{handler:"saveToLocalStorage",deep:!0},ronglian_addon:{handler:"saveToLocalStorage",deep:!0},equip_params:{handler(e){this.$api.equipment.extractFeatures({equipment_data:e,data_type:"equipment"}).then(e=>{this.features=e.data.features,this.currentKindid=e.data.kindid})},immediate:!0},equip_desc:{handler(e){const t=e.equip_type_desc,i=t.match(/等级\s*(\d+)/);i&&(this.level=parseInt(i[1]))},immediate:!0}},methods:{clearAttrs(){this.addon={tizhi:0,naili:0,moli:0,minjie:0,liliang:0,wakan:0,magic_damage:0,magic_defence:0,mofa:0,mingzhong:0,shanghai:0,speed:0,defence:0,hp:0,fengyin:0,anti_fengyin:0}},handleSuitChange(e){this.suit_effect=e[1]},saveToLocalStorage(){try{const e={iType:this.iType,level:this.level,wu_xing:this.wu_xing,naijiu:this.naijiu,repair_fail:this.repair_fail,gemLevel:this.gemLevel,gemType:this.gemType,special_skill:this.special_skill,special_effect:this.special_effect,kaiyun_num:this.kaiyun_num,isDoubleKaiyun:this.isDoubleKaiyun,attrs_list:this.attrs_list,addon:this.addon,ronglian_addon:this.ronglian_addon,suit_effect:this.suit_effect};localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(e){console.error("保存数据到localStorage失败:",e)}},loadFromLocalStorage(){try{const e=localStorage.getItem(this.storageKey);if(e){const t=JSON.parse(e);void 0!==t.iType&&(this.iType=t.iType),void 0!==t.level&&(this.level=t.level),void 0!==t.wu_xing&&(this.wu_xing=t.wu_xing),void 0!==t.naijiu&&(this.naijiu=t.naijiu),void 0!==t.repair_fail&&(this.repair_fail=t.repair_fail),void 0!==t.gemLevel&&(this.gemLevel=t.gemLevel),void 0!==t.gemType&&(this.gemType=t.gemType),void 0!==t.special_skill&&(this.special_skill=t.special_skill),void 0!==t.special_effect&&(this.special_effect=t.special_effect),void 0!==t.kaiyun_num&&(this.kaiyun_num=t.kaiyun_num),void 0!==t.isDoubleKaiyun&&(this.isDoubleKaiyun=t.isDoubleKaiyun),void 0!==t.attrs_list&&(this.attrs_list=t.attrs_list),void 0!==t.addon&&(this.addon=t.addon),void 0!==t.ronglian_addon&&(this.ronglian_addon=t.ronglian_addon),console.log("从localStorage恢复数据成功")}}catch(e){console.error("从localStorage加载数据失败:",e)}},clearLocalStorage(){try{localStorage.removeItem(this.storageKey),console.log("localStorage缓存已清除"),this.$notify.success({title:"提示",message:"localStorage缓存已清除"})}catch(e){console.error("清除localStorage缓存失败:",e),this.$notify.error({title:"提示",message:"清除缓存失败"})}},changeAttrTypeRange(e,t){const i=this.currentLevelLingshiConfig[e];this.$set(this.attrs_list[t],"range",i)},getLingshiConfig(){this.$api.equipment.getLingshiConfig().then(e=>{this.lingshiConfig=e.data})},async loadSimilarEquipments(e){this.equipmentValuation={},this.similarEquipments=null,await this.loadEquipmentValuation(e,.8)},async loadEquipmentValuation(e,t){try{const i=await this.$api.equipment.getEquipmentValuation({equipment_data:e,strategy:"fair_value",similarity_threshold:t,max_anchors:30}),a=i.data;if(200===i.code&&a?.anchor_count>0){this.equipmentValuation=a;const{data:{anchors:i}}=await this.$api.equipment.findEquipmentAnchors({equipment_data:e,similarity_threshold:t,max_anchors:30});this.similarEquipments={anchor_count:a.anchor_count,similarity_threshold:a.similarity_threshold,anchors:i,statistics:{price_range:{min:Math.min(...i.map(e=>e.price||0)),max:Math.max(...i.map(e=>e.price||0))},similarity_range:{min:Math.min(...i.map(e=>e.similarity||0)),max:Math.max(...i.map(e=>e.similarity||0)),avg:i.reduce((e,t)=>e+(t.similarity||0),0)/i.length}}}}else 400===i.code&&(this.equipmentValuation=a,this.similarData={anchor_count:0,similarity_threshold:this.valuateParams.similarity_threshold,max_anchors:this.valuateParams.max_anchors,anchors:[],statistics:{price_range:{min:0,max:0},similarity_range:{min:0,max:0,avg:0}}});console.log("估价和相似装备数据:",i.data)}catch(i){console.error("加载相似装备或估价失败:",i)}},parseEquipDesc(e,t="#Y"){return e?"function"===typeof window.parse_style_info?window.parse_style_info(e,t):e:""},takeSnapshot(){this.$prompt("请输入快照名称","创建快照",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S+/,inputErrorMessage:"快照名称不能为空"}).then(({value:e})=>{const t={id:Date.now(),name:e,timestamp:(new Date).toISOString(),equipment:{iType:this.iType,level:this.level,wu_xing:this.wu_xing,naijiu:this.naijiu,repair_fail:this.repair_fail,gemLevel:this.gemLevel,gemType:[...this.gemType],special_skill:this.special_skill,special_effect:[...this.special_effect],kaiyun_num:this.kaiyun_num,isDoubleKaiyun:this.isDoubleKaiyun,attrs_list:JSON.parse(JSON.stringify(this.attrs_list)),addon:{...this.addon},ronglian_addon:{...this.ronglian_addon},suit_effect:this.suit_effect,equip_name:this.equipment.equip_name,equip_type_desc:this.equipment.equip_type_desc,equip_face_img:this.equipment.equip_face_img,large_equip_desc:this.large_equip_desc}};this.snapshots.unshift(t),this.saveSnapshotsToStorage(),this.$notify.success({title:"提示",message:`快照 "${e}" 已创建！`})}).catch(()=>{})},showSnapshotDetail(e){this.currentSnapshot=e,this.snapshotDialogVisible=!0},deleteSnapshot(e){this.snapshots=this.snapshots.filter(t=>t.id!==e),this.saveSnapshotsToStorage(),this.$notify.success({title:"提示",message:"快照已删除！"})},restoreSnapshot(){this.currentSnapshot&&(this.iType=this.currentSnapshot.equipment.iType,this.level=this.currentSnapshot.equipment.level,this.wu_xing=this.currentSnapshot.equipment.wu_xing,this.naijiu=this.currentSnapshot.equipment.naijiu,this.repair_fail=this.currentSnapshot.equipment.repair_fail,this.gemLevel=this.currentSnapshot.equipment.gemLevel,this.gemType=[...this.currentSnapshot.equipment.gemType],this.special_skill=this.currentSnapshot.equipment.special_skill,this.special_effect=[...this.currentSnapshot.equipment.special_effect],this.kaiyun_num=this.currentSnapshot.equipment.kaiyun_num,this.isDoubleKaiyun=this.currentSnapshot.equipment.isDoubleKaiyun,this.attrs_list=JSON.parse(JSON.stringify(this.currentSnapshot.equipment.attrs_list)),this.addon={...this.currentSnapshot.equipment.addon},this.ronglian_addon={...this.currentSnapshot.equipment.ronglian_addon},this.suit_effect=this.currentSnapshot.equipment.suit_effect,this.snapshotDialogVisible=!1,this.currentSnapshot=null,this.$notify.success("快照已恢复！"))},saveSnapshotsToStorage(){localStorage.setItem(this.snapshotStorageKey,JSON.stringify(this.snapshots))},async loadAbnormalData(){this.loadingAbnormal=!0;try{const e={page:this.abnormalPage,page_size:this.abnormalPageSize,status:this.abnormalStatusFilter},t=await this.$api.equipment.getAbnormalEquipmentList(e);200===t.code?(this.abnormalEquipments=t.data.items||[],this.abnormalTotal=t.data.total||0):this.$notify.error(t.message||"加载异常装备数据失败")}catch(e){console.error("加载异常装备数据失败:",e),this.$notify.error("加载异常装备数据失败")}finally{this.loadingAbnormal=!1}},handleAbnormalPageChange(e){this.abnormalPage=e,this.loadAbnormalData()},clearAllAbnormal(){this.$confirm("确定要清空所有异常装备记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{this.$notify.info("批量删除功能待实现"),this.loadAbnormalData()}).catch(()=>{})},handleAbnormalAction(e){const[t,i]=e.split("_");"view"===t?this.showSnapshotDetail({id:Date.now(),name:`异常装备-${i}`,timestamp:(new Date).toISOString(),equipment:{iType:this.iType,level:this.level,wu_xing:this.wu_xing,naijiu:this.naijiu,repair_fail:this.repair_fail,gemLevel:this.gemLevel,gemType:[...this.gemType],special_skill:this.special_skill,special_effect:[...this.special_effect],kaiyun_num:this.kaiyun_num,isDoubleKaiyun:this.isDoubleKaiyun,attrs_list:JSON.parse(JSON.stringify(this.attrs_list)),addon:{...this.addon},ronglian_addon:{...this.ronglian_addon},suit_effect:this.suit_effect,equip_name:this.equipment.equip_name,equip_type_desc:this.equipment.equip_type_desc,equip_face_img:this.equipment.equip_face_img,large_equip_desc:this.large_equip_desc}}):"edit"===t?(this.currentEditEquipSn=i,this.currentEditStatus=this.abnormalEquipments.find(e=>e.equip_sn===i)?.status||"pending",this.statusEditDialogVisible=!0):"delete"===t&&this.$confirm(`确定要删除序列号为 ${i} 的异常装备记录吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await this.$api.equipment.deleteAbnormalEquipment(i),this.$notify.success(`序列号为 ${i} 的异常装备记录已删除！`),this.loadAbnormalData()}catch(e){this.$notify.error("删除记录失败")}}).catch(()=>{})},getStatusTagType(e){switch(e){case"pending":return"warning";case"resolved":return"success";case"ignored":return"info";case"investigating":return"danger";default:return"info"}},getStatusText(e){switch(e){case"pending":return"待处理";case"resolved":return"已解决";case"ignored":return"已忽略";case"investigating":return"调查中";default:return"未知"}},formatTime(e){if(!e)return"未知时间";try{const t=new Date(e);return t.toLocaleString("zh-CN")}catch(t){return e}},handleStatusEditSuccess(e){this.loadAbnormalData()},handleStatusEditClose(){this.statusEditDialogVisible=!1,this.currentEditEquipSn="",this.currentEditStatus=""}},mounted(){this.getLingshiConfig(),this.loadFromLocalStorage();const e=localStorage.getItem(this.snapshotStorageKey);e&&(this.snapshots=JSON.parse(e)),this.loadAbnormalData()}},f=g,v=(0,h.A)(f,a,s,!1,null,"647c90af",null),y=v.exports}}]);
//# sourceMappingURL=342.1ea5d1e9.js.map