"use strict";(self["webpackChunkweb"]=self["webpackChunkweb"]||[]).push([[548],{3605:function(e,t,i){i.d(t,{A:function(){return p}});var a=function(){var e=this,t=e._self._c;return t("el-button",{attrs:{type:"success"},on:{click:e.goToMoreSimilar}},[e._v(" 查看更多相似 ")])},n=[],s=(i(8111),i(3579),i(8554)),r=i.n(s),o=i(1878),l={name:"SimilarGetMore",props:{message:{type:String,default:""},targetEquipment:{type:Object,default:()=>({})},type:{type:String,default:"equip"}},methods:{async goToMoreSimilar(){let e={};if("equip"===this.type){console.log(this.targetEquipment,"this.targetEquipment");const{equip_name:t,large_equip_desc:i,equip_type_desc:a,icon:n,equip_face_img:s,equip_level:r,kindid:o,equip_type:l,iType:c,serverid:u,server_name:d}=this.targetEquipment;e={action:"similar_equip",equip_type:"normal",activeTab:"equip",equip_name:t,large_equip_desc:i,equip_type_desc:a,equip_face_img:s||n,equip_level:r,kindid:o,type:c||l||void 0,serverid:u,server_name:d},window.is_pet_equip(e.kindid)?e.equip_type="pet":window.lingshiKinds.some(([t])=>t===e.kindid)&&(e.equip_type="lingshi"),e.equip_name||(e.equip_name=this.targetEquipment.name),e.equip_type_desc||(e.equip_type_desc=this.targetEquipment.static_desc)}else if("pet"===this.type){const{equip_sn:t,role_grade_limit:i,equip_level:a,growth:n,is_baobao:s,all_skill:r,sp_skill:o,evol_skill_list:l,texing:c,lx:u,equip_list:d,neidan:p,equip_face_img:m,serverid:_,server_name:h}=this.targetEquipment;e={action:"similar_pet",activeTab:"pet",equip_face_img:m,equip_sn:t,role_grade_limit:i,equip_level:a,growth:n,is_baobao:s,all_skill:r,sp_skill:o,evol_skill_list:l,texing:c,lx:u,equip_list:d,neidan:p,serverid:_,server_name:h},console.log(e,"externalParams")}console.log("🔍 开始检查可复用的窗口，参数:",e);const t=await o.A.checkForExistingWindow(e,1e3);if(t)return console.log("✅ 找到可复用的窗口:",t.windowId),o.A.requestFocus(t.windowId),console.log("🔄 直接更新窗口参数，强制刷新页面..."),o.A.requestUpdateParams(t.windowId,e),void console.log("🎯 复用已存在的窗口:",t.windowId);console.log("❌ 没有找到可复用的窗口，创建新窗口"),this.createNewWindow(e)},createNewWindow(e){const t=r().stringify(e),i=`/#/auto-params?${t}`,a=window.screen.availWidth,n=window.screen.availHeight,s=1e3,o=700,l=a-s-20,c=n-o-20,u=window.open(i,"_blank",`popup=1,location=no,width=${s},height=${o},left=${l},top=${c}`);u&&console.log("创建新窗口:",i)}},mounted(){console.log(this.targetEquipment,"this.targetEquipment")}},c=l,u=i(1656),d=(0,u.A)(c,a,n,!1,null,null,null),p=d.exports},7548:function(e,t,i){i.d(t,{A:function(){return E}});var a=function(){var e=this,t=e._self._c;return t("el-popover",{attrs:{"data-equip-sn":e.equipment.equip_sn,placement:e.placement,width:"720",trigger:"click","popper-class":"similar-equip-popper"},on:{show:e.handleShow},scopedSlots:e._u([{key:"reference",fn:function(){return[e._t("default",function(){return[t("el-link",{staticStyle:{"font-size":"12px"},attrs:{type:"primary"}},[e._v("查看相似")])]})]},proxy:!0}],null,!0),model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[e.visible?t("div",[e.valuationLoading?t("div",{staticClass:"loading-info"},[t("el-skeleton",{attrs:{rows:12,animated:""}})],1):e.similarData?t("div",[t("div",{staticClass:"similar-header"},[t("h4",[e._v("相似装备 (共"+e._s(e.similarData.anchor_count)+"个) "),t("el-divider",{attrs:{direction:"vertical"}}),t("el-tag",{attrs:{type:"info",size:"mini"}},[e._v("相似度阈值: "+e._s(e.similarData.similarity_threshold))]),t("el-divider",{attrs:{direction:"vertical"}}),t("el-tag",{attrs:{type:"info",size:"mini"}},[e._v("最大锚点数: "+e._s(e.similarData.max_anchors))])],1),t("EquipmentValuation",{attrs:{valuation:e.equipmentValuation,"target-equipment":e.getEquipImageProps(e.equipment)},on:{refresh:e.refresh}}),e.similarData.statistics?t("div",{staticClass:"stats"},[t("span",[e._v(" 价格范围: "),t("span",{domProps:{innerHTML:e._s(e.formatPrice(e.similarData.statistics.price_range.min))}}),e._v(" - "),t("span",{domProps:{innerHTML:e._s(e.formatPrice(e.similarData.statistics.price_range.max))}})]),t("span",[e._v(" 平均相似度: "+e._s(e.similarData.statistics.similarity_range.avg.toFixed(3))+" ")])]):e._e()],1),e.anchorsLoading||e.similarData?.anchors?.length?t("SimilarEquipmentTable",{directives:[{name:"loading",rawName:"v-loading",value:e.anchorsLoading,expression:"anchorsLoading"}],attrs:{anchors:e.similarData.anchors,"element-loading-text":"正在加载相似装备"}}):t("el-empty",{attrs:{description:"暂无数据"}})],1):e._e()]):e._e()])},n=[],s=(i(8111),i(1701),i(8237),function(){var e=this,t=e._self._c;return t("div",{staticClass:"valuation-info",class:e.confidenceClass},[t("el-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[t("el-row",{attrs:{type:"flex",align:"middle"}},[t("EquipmentImage",{attrs:{equipment:e.targetEquipment,width:"50px",height:"50px",placement:"left"}}),e.targetEquipment.price?t("span",{staticStyle:{"margin-left":"10px"},domProps:{innerHTML:e._s(e.formatFullPrice(e.targetEquipment))}}):e._e(),e.isWeapon?t("div",{staticStyle:{"margin-left":"10px"}},[t("div",{staticStyle:{"margin-bottom":"5px"}},[t("el-tag",{attrs:{type:"success"}},[e._v("属性：+"+e._s(e.valuation.feature.addon_total)+"点"+e._s(e.addon_total_standards?.[e.valuation.feature.equip_level]))]),t("el-divider",{attrs:{direction:"vertical"}}),t("el-tag",{attrs:{type:"primary"}},[e._v("总伤："+e._s(e.valuation.feature.all_damage)+"/"+e._s(parseInt(e.all_damage_standards?.[e.valuation.feature.equip_level][1]+25*e.valuation.feature.equip_level/30)))])],1),t("div",[t("el-tag",{attrs:{type:"danger"}},[e._v("初伤："+e._s(e.valuation.feature.init_damage_raw)+"点"+e._s(e.init_damage_raw_standards?.[e.valuation.feature.equip_level]))]),t("el-divider",{attrs:{direction:"vertical"}}),t("el-tag",{attrs:{type:"danger"}},[e._v("初总伤："+e._s(e.valuation.feature.init_damage)+"点"+e._s(e.all_damage_standards?.[e.valuation.feature.equip_level]))])],1)]):e._e()],1),t("div",{staticStyle:{width:"170px","flex-shrink":"0"}},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.$emit("refresh")}}},[e._v("刷新")]),t("SimilarGetMore",{attrs:{"target-equipment":e.targetEquipment}})],1)],1),t("div",{staticClass:"valuation-main"},[t("span",{staticClass:"valuation-label"},[e._v("装备估价:")]),t("span",{staticClass:"valuation-price"},[e._v(e._s(e.valuation?.estimated_price_yuan||"-")+"元")]),t("span",{staticClass:"valuation-strategy"},[e._v("("+e._s(e.valuation?e.getStrategyName(e.valuation.strategy):"-")+")")]),t("el-link",{attrs:{type:"danger",size:"mini"},nativeOn:{click:function(t){return e.markAsAbnormal.apply(null,arguments)}}},[e._v("标记为异常")]),e.priceRatio?t("span",{staticClass:"price-ratio"},[t("el-tag",{attrs:{type:e.priceRatioTagType,"disable-transitions":""}},[e._v(" "+e._s(e.priceRatioText)+" ")])],1):e._e()],1),t("div",{staticClass:"valuation-details"},[t("span",{staticClass:"confidence-display",class:e.confidenceTextClass},[t("i",{class:e.confidenceIcon}),e._v(" 置信度: "+e._s(e.valuation?(100*e.valuation.confidence).toFixed(1)+"%":"-")+" "),t("span",{staticClass:"confidence-level"},[e._v(e._s(e.confidenceLevel))])]),t("span",[e._v("基于"+e._s(e.valuation.anchor_count)+"个锚点")]),e.priceRatio?t("span",[e._v("估价比率: "+e._s((100*e.priceRatio).toFixed(1))+"%")]):e._e()])],1)}),r=[],o=i(3016),l=i(6175),c=i(8770),u=i(3605),d={name:"EquipmentValuation",components:{EquipmentImage:o.A,SimilarGetMore:u.A},mixins:[l.G,c.B],props:{valuation:{type:Object,default:null},targetEquipment:{type:Object,required:!0}},data(){return{weaponConfig:null,addon_total_standards:null,all_damage_standards:null,init_damage_raw_standards:null}},computed:{isWeapon(){return window.is_weapon_equip(this.valuation?.feature?.kindid)},priceRatio(){if(!this.valuation||!this.valuation.estimated_price_yuan||!this.targetEquipment.price)return null;const e=parseFloat(this.valuation.estimated_price_yuan),t=parseFloat(this.targetEquipment.price)/100;return 0===t?null:e/t},priceRatioTagType(){if(!this.priceRatio)return"";const e=this.priceRatio,t=100*Math.abs(e-1);return t<5?"success":t<10?"info":t<20?"warning":"danger"},priceRatioText(){if(!this.priceRatio)return"";const e=this.priceRatio,t=100*Math.abs(e-1);return t<5?`估价极为贴合市场（±${t.toFixed(1)}%）`:t<10?`估价较为贴合（±${t.toFixed(1)}%）`:t<20?`估价有一定偏差（±${t.toFixed(1)}%）`:e>1?`估价高于市场（+${(100*(e-1)).toFixed(1)}%）`:`估价低于市场（-${(100*(1-e)).toFixed(1)}%）`},confidenceClass(){if(!this.valuation||!this.valuation.confidence)return"confidence-extremely-low";const e=this.valuation.confidence;return e>=.8?"confidence-high":e>=.6?"confidence-medium":e>=.4?"confidence-low":e>=.2?"confidence-very-low":"confidence-extremely-low"},confidenceTextClass(){if(!this.valuation||!this.valuation.confidence)return"text-danger";const e=this.valuation.confidence;return e>=.8?"text-success":e>=.6?"text-primary":e>=.4?"text-info":e>=.2?"text-warning":"text-danger"},confidenceIcon(){if(!this.valuation||!this.valuation.confidence)return"el-icon-warning";const e=this.valuation.confidence;return e>=.8?"el-icon-success":e>=.6?"el-icon-info":e>=.4?"el-icon-question":e>=.2?"el-icon-warning":"el-icon-error"},confidenceLevel(){if(!this.valuation||!this.valuation.confidence)return"(数据缺失)";const e=this.valuation.confidence;return e>=.8?"(高)":e>=.6?"(中)":e>=.4?"(偏低)":e>=.2?"(很低)":"(极低)"}},methods:{getWeaponConfig(){this.$api.equipment.getWeaponConfig().then(e=>{200===e.code&&(this.weaponConfig=e.data,this.addon_total_standards=e.data.addon_total_standards,this.all_damage_standards=e.data.all_damage_standards,this.init_damage_raw_standards=e.data.init_damage_raw_standards)})},async markAsAbnormal(){try{const e=await this.$api.equipment.markEquipmentAsAbnormal({equipment_data:this.targetEquipment,reason:"标记异常",notes:"用户手动标记的异常装备"});200===e.code?(this.$notify.success({title:"提示",message:"装备已标记为异常"}),this.$emit("abnormal-marked",this.targetEquipment)):this.$notify.error({title:"提示",message:e.message||"标记异常失败"})}catch(e){console.error("标记异常失败:",e),this.$notify.error({title:"提示",message:"标记异常失败，请稍后重试"})}},getStrategyName(e){const t={fair_value:"公允价值",competitive:"竞争价格",premium:"溢价估值"};return t[e]||e}},mounted(){this.isWeapon&&this.getWeaponConfig()}},p=d,m=i(1656),_=(0,m.A)(p,s,r,!1,null,"c5a9f81a",null),h=_.exports,g=function(){var e=this,t=e._self._c;return t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.anchors,stripe:"","max-height":"300",sortable:"","sort-by":["price","similarity"],"sort-order":["ascending","descending"]}},[t("el-table-column",{attrs:{fixed:"",prop:"price",label:"价格 (元)",width:"100",sortable:""},scopedSlots:e._u([{key:"default",fn:function(i){return[t("div",{domProps:{innerHTML:e._s(e.formatFullPrice(i.row,!0))}})]}}])}),t("el-table-column",{attrs:{fixed:"",label:"装备",width:"70"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("equipment-image",{attrs:{equipment:e.row}})]}}])}),t("el-table-column",{attrs:{prop:"similarity",label:"相似度",width:"80",sortable:""},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-tag",{attrs:{type:e.getSimilarityTagType(i.row.similarity)}},[e._v(" "+e._s(i.row.similarity)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"equip_level",label:"等级",width:"60"}}),t("el-table-column",{attrs:{label:"特技/特效/套装","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("div",{staticClass:"special-info"},[t("div",{staticClass:"equip_desc_blue",attrs:{"data-specia-effet":i.row.special_effect,"data-special-skill":i.row.special_skill}}),t("p",{domProps:{innerHTML:e._s(e.formatSpecialSkillsAndEffects(i.row))}}),t("p",[e._v(" "+e._s(e.formatSuitEffect(i.row)))])])]}}])}),t("el-table-column",{attrs:{prop:"server_name",label:"服务器",width:"80"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",[e._v(e._s(i.row.server_name))]),t("div",{domProps:{innerHTML:e._s(e.formatFullPrice(i.row,"cross"))}})]}}])}),t("el-table-column",{attrs:{label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-link",{attrs:{href:e.getCBGLinkByType(i.row.eid,"equip"),type:"danger",target:"_blank"}},[e._v("藏宝阁")])]}}])})],1)},f=[],v={name:"SimilarEquipmentTable",components:{EquipmentImage:o.A},mixins:[l.G,c.B],props:{anchors:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},methods:{getSpecialEffectName(e){if(window.AUTO_SEARCH_CONFIG&&window.AUTO_SEARCH_CONFIG.equip_special_effect){const t=window.AUTO_SEARCH_CONFIG.equip_special_effect[e.toString()];if(t)return t}return`特效${e}`}}},y=v,q=(0,m.A)(y,g,f,!1,null,"9e54bfd6",null),w=q.exports,x={name:"SimilarEquipmentModal",components:{EquipmentValuation:h,SimilarEquipmentTable:w},mixins:[l.G,c.B],props:{equipment:{type:Object,required:!0},placement:{type:String,default:"left-end"},similarityThreshold:{type:Number,default:.8},maxAnchors:{type:Number,default:30}},data(){return{visible:!1,valuationLoading:!1,anchorsLoading:!1,error:!1,similarData:null,equipmentValuation:{}}},computed:{loading(){return this.valuationLoading||this.anchorsLoading}},methods:{async handleShow(){this.similarData||await this.loadSimilarEquipments()},async refresh(){await this.loadSimilarEquipments()},async loadSimilarEquipments(){this.error=!1,this.equipmentValuation={},this.similarData=null;try{await this.loadEquipmentValuation(this.equipment,this.similarityThreshold)}catch(e){console.error("加载相似装备失败:",e),this.error=!0}},async loadEquipmentValuation(e,t){try{this.valuationLoading=!0,window.is_pet_equip(e.kindid)&&(e={kindid:29,desc:e.desc});const a=await this.$api.equipment.getEquipmentValuation({equipment_data:e,strategy:"fair_value",similarity_threshold:t,max_anchors:this.maxAnchors}),n=a.data;if(this.equipmentValuation=n,this.$emit("valuation-updated",n),this.similarData={anchor_count:n.anchor_count,similarity_threshold:n.similarity_threshold||t,max_anchors:n.max_anchors||this.maxAnchors,anchors:[],statistics:{price_range:n.anchor_count?{min:Math.min(...n.anchors.map(e=>e.price||0)),max:Math.max(...n.anchors.map(e=>e.price||0)),avg:n.anchors.reduce((e,t)=>e+(t.price||0),0)/n.anchors.length}:{min:0,max:0,avg:0},similarity_range:n.anchor_count?{min:Math.min(...n.anchors.map(e=>e.similarity||0)),max:Math.max(...n.anchors.map(e=>e.similarity||0)),avg:n.anchors.reduce((e,t)=>e+(t.similarity||0),0)/n.anchors.length}:{min:0,max:0,avg:0}}},this.valuationLoading=!1,n?.anchor_count>0&&n?.anchors?.length>0){this.anchorsLoading=!0;try{const e=await this.$api.equipment.getEquipmentList({page_size:99,equip_sn_list:n.anchors.map(e=>e.equip_sn)});if(this.anchorsLoading=!1,200===e.code&&e.data?.data){const t=e.data.data,i=t.map((e,t)=>(e.similarity=n.anchors[t].similarity,e.features=n.anchors[t].features,e));this.$set(this.similarData,"anchors",i)}else console.warn("未获取到相似装备锚点数据:",e.message)}catch(i){console.error("查询相似装备锚点失败:",i)}}}catch(i){throw console.error("装备估价失败:",i),this.$notify.error({title:"估价请求失败",message:"网络请求异常，请稍后重试",duration:3e3}),i}finally{this.valuationLoading=!1,this.anchorsLoading=!1}}}},b=x,k=(0,m.A)(b,a,n,!1,null,"8d4f6d00",null),E=k.exports}}]);
//# sourceMappingURL=548.d445c017.js.map