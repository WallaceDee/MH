"use strict";(self["webpackChunkweb"]=self["webpackChunkweb"]||[]).push([[996],{1153:function(e,t,a){var s=a(2856),r=a(1910),i=a(7779);s["default"].use(r.Ay);const o={namespaced:!0,state:{cookieValidationCache:{lastValidTime:null,cacheDuration:3e5,isValid:!1}},getters:{isCookieCacheValid:e=>{if(!e.cookieValidationCache.isValid||!e.cookieValidationCache.lastValidTime)return!1;const t=Date.now(),a=t-e.cookieValidationCache.lastValidTime;return a<e.cookieValidationCache.cacheDuration},getCacheRemainingMinutes:e=>{if(!e.cookieValidationCache.isValid||!e.cookieValidationCache.lastValidTime)return 0;const t=Date.now(),a=t-e.cookieValidationCache.lastValidTime,s=e.cookieValidationCache.cacheDuration-a;return s<=0?0:Math.ceil(s/6e4)},getCacheExpiryTime:e=>e.cookieValidationCache.isValid&&e.cookieValidationCache.lastValidTime?new Date(e.cookieValidationCache.lastValidTime+e.cookieValidationCache.cacheDuration):null,getCookieCache:e=>e.cookieValidationCache},mutations:{updateCookieCache(e,t){e.cookieValidationCache.isValid=t,t?(e.cookieValidationCache.lastValidTime=Date.now(),console.log("CookieéªŒè¯ç¼“å­˜å·²æ›´æ–°ï¼Œæœ‰æ•ˆæœŸ5åˆ†é’Ÿ")):(e.cookieValidationCache.lastValidTime=null,console.log("CookieéªŒè¯ç¼“å­˜å·²æ¸…é™¤"))}},actions:{clearCookieCache({commit:e}){e("updateCookieCache",!1)},cleanExpiredCache({commit:e,getters:t}){t.isCookieCacheValid||(e("updateCookieCache",!1),console.log("è¿‡æœŸç¼“å­˜å·²è‡ªåŠ¨æ¸…ç†"))}}},n={namespaced:!0,state:{equipsAndPetsData:[]},getters:{getEquipsAndPetsData:e=>e.equipsAndPetsData,getDataCount:e=>e.equipsAndPetsData.length},mutations:{setEquipsAndPetsData(e,t){e.equipsAndPetsData=Array.isArray(t)?t:[],console.log("Vuex: è£…å¤‡å’Œå¬å”¤å…½æ•°æ®å·²æ›´æ–°, æ•°é‡:",e.equipsAndPetsData.length)},unshiftEquipsAndPetsData(e,t){Array.isArray(t)&&(e.equipsAndPetsData.unshift(...t),console.log("Vuex: è¿½åŠ è£…å¤‡å’Œå¬å”¤å…½æ•°æ®, æ–°å¢ž:",t.length,"æ€»è®¡:",e.equipsAndPetsData.length))},clearEquipsAndPetsData(e){e.equipsAndPetsData=[],console.log("Vuex: è£…å¤‡å’Œå¬å”¤å…½æ•°æ®å·²æ¸…ç©º")}},actions:{updateEquipsAndPetsData({commit:e},t){e("setEquipsAndPetsData",t)},appendEquipsAndPetsData({commit:e},t){e("unshiftEquipsAndPetsData",t)},clearData({commit:e}){e("clearEquipsAndPetsData")}}};t.A=new r.Ay.Store({state:{areaid:43,server_id:77,server_name:"è¿›è´¤é—¨",server_data_value:[43,77]},getters:{getCurrentServerData:e=>({areaid:e.areaid,server_id:e.server_id,server_name:e.server_name,server_data_value:e.server_data_value})},mutations:{updateServerData(e,{areaid:t,server_id:a,server_name:s}){e.areaid=t,e.server_id=a,e.server_name=s,e.server_data_value=[t,a]},updateServerDataValue(e,t){if(Array.isArray(t)&&t.length>=2){if(e.server_data_value=t,e.areaid=t[0],e.server_id=t[1],window.server_data)for(let a in window.server_data){let[s,r]=window.server_data[a];const[,,,,i]=s;if(i===t[0]){for(let a of r)if(a[0]===t[1]){e.server_name=a[1];break}break}}}else e.server_data_value=[43,77],e.areaid=43,e.server_id=77,e.server_name="è¿›è´¤é—¨"}},actions:{setServerData({commit:e},{areaid:t,server_id:a,server_name:s}){e("updateServerData",{areaid:t,server_id:a,server_name:s})},setServerDataValue({commit:e},t){e("updateServerDataValue",t)}},modules:{cookie:o,chromeDevtools:n},plugins:[(0,i.A)({key:"cbg-cookie-cache",storage:window.localStorage})]})},2361:function(e,t,a){a.d(t,{g:function(){return r}});var s=a(7120);const r={getPetList(e={}){return s.FH.get("/pet/",e)},getPetDetail(e,t={}){return s.FH.get(`/pet/${e}`,t)},findPetAnchors(e){return s.FH.post("/pet/anchors",e)},getPetValuation(e){return s.FH.post("/pet/valuation",e)},batchPetValuation(e){return s.FH.post("/pet/batch-valuation",e)},updatePetEquipmentsPrice(e){return s.FH.post("/pet/update-equipments-price",e)},getUnvaluedPetsCount(e={}){return s.FH.get("/pet/unvalued-count",e)},batchUpdateUnvaluedPets(e={}){return s.FH.post("/pet/batch-update-unvalued",e)},getTaskStatus(e){return s.FH.get(`/pet/task-status/${e}`)},getActiveTasks(){return s.FH.get("/pet/active-tasks")},stopTask(e){return s.FH.post(`/pet/stop-task/${e}`)},deletePet(e,t={}){return s.FH.delete(`/pet/${e}`,t)},getPetByEquipSn(e,t,a){return s.FH.get(`/pet/${e}/${t}/${a}`)},getPetStats(e={}){return s.FH.get("/pet/stats",e)}}},3443:function(e,t,a){a.d(t,{u:function(){return r}});var s=a(7120);const r={getSystemInfo(){return s.FH.get("/system/info")},getFiles(){return s.FH.get("/system/files")},downloadFile(e){return s.FH.get(`/system/files/${e}/download`)},getHotServers(){return s.FH.get("/system/config-file/hot_server_list.json")},getLimitedSkinConfig(){return s.FH.get("/system/config-file/ex_avt_value.jsonc")},getSearchParams(){return s.FH.get("/system/config/search-params")},getSearchParamByType(e){return s.FH.get(`/system/config/search-params/${e}`)},updateSearchParam(e,t){return s.FH.post(`/system/config/search-params/${e}`,t)},getMarketDataStatus(){return s.FH.get("/system/market-data/status")},getMarketDataAnalysis(){return s.FH.get("/system/market-data/analysis")},refreshMarketData(){return s.FH.post("/system/market-data/refresh",{force_refresh:!1,use_cache:!0})},refreshFullCache(){return s.FH.post("/system/market-data/refresh",{force_refresh:!0,use_cache:!0})},getRoleRefreshStatus(){return s.FH.get("/system/market-data/role/refresh-status")},getCacheStatus(){return s.FH.get("/system/market-data/cache-status")},getEquipmentCacheStatus(){return s.FH.get("/system/market-data/equipment/cache-status")},refreshEquipmentData(){return s.FH.post("/system/market-data/equipment/refresh",{force_refresh:!1,use_cache:!0})},refreshEquipmentFullCache(){return s.FH.post("/system/market-data/equipment/refresh",{force_refresh:!0,use_cache:!0})},getEquipmentMarketDataStatus(){return s.FH.get("/system/market-data/equipment/status")},getRedisStatus(){return s.FH.get("/system/redis/status")},getEquipmentRefreshStatus(){return s.FH.get("/system/market-data/equipment/refresh-status")},getPetCacheStatus(){return s.FH.get("/system/market-data/pet/cache-status")},getPetMarketDataStatus(){return s.FH.get("/system/market-data/pet/status")},refreshPetData(){return s.FH.post("/system/market-data/pet/refresh",{force_refresh:!1,use_cache:!0})},refreshPetFullCache(){return s.FH.post("/system/market-data/pet/refresh",{force_refresh:!0,use_cache:!0})},getPetRefreshStatus(){return s.FH.get("/system/market-data/pet/refresh-status")},getSystemStats(){return s.FH.get("/system/stats")}}},5179:function(e,t,a){a.d(t,{A:function(){return _}});var s=function(){var e=this,t=e._self._c;return t("el-container",[e.$route.meta.showHeader?t("Header"):e._e(),t("el-main",{style:{padding:e.$route.meta.showHeader?"20px":"0"}},[t("router-view")],1)],1)},r=[],i=function(){var e=this,t=e._self._c;return t("el-header",[t("div",{staticClass:"header-content"},[t("el-menu",{attrs:{mode:"horizontal",router:!0,"default-active":e.activeMenuIndex}},[t("el-menu-item",{attrs:{index:"/"}},[e._v("ðŸ ï¸"),t("span",{staticClass:"menu-item-text"},[e._v("é¦–é¡µ")])]),t("el-menu-item",{attrs:{index:"/roles/normal/109,175/1"}},[e._v("ðŸ‘¥"),t("span",{staticClass:"menu-item-text"},[e._v("è§’è‰²")])]),t("el-menu-item",{attrs:{index:"/roles/empty/109,175/1"}},[e._v("ðŸŽ¯"),t("span",{staticClass:"menu-item-text"},[e._v("ç©ºå·")])]),t("el-menu-item",{attrs:{index:"/equipments"}},[e._v("âš”ï¸"),t("span",{staticClass:"menu-item-text"},[e._v("è£…å¤‡")])]),t("el-menu-item",{attrs:{index:"/pets"}},[e._v("ðŸ²"),t("span",{staticClass:"menu-item-text"},[e._v("å¬å”¤å…½")])]),t("el-menu-item",{attrs:{index:"/equipment-desc-creator"}},[e._v("ðŸ”¨"),t("span",{staticClass:"menu-item-text"},[e._v("è£…å¤‡æ¨¡æ‹Ÿ")])]),t("el-menu-item",{attrs:{index:"/market-data-status"}},[e._v("ðŸ“Š"),t("span",{staticClass:"menu-item-text"},[e._v("æ•°æ®çŠ¶æ€")])]),t("el-menu-item",{attrs:{index:"/admin/users"}},[e._v("ðŸ‘¤"),t("span",{staticClass:"menu-item-text"},[e._v("ç”¨æˆ·ç®¡ç†")])])],1),t("div",{staticClass:"header-right"},[t("el-popover",{attrs:{placement:"bottom",width:"400",trigger:"click","popper-class":"cookie-popover","visible-arrow":!1}},[t("el-button",{staticClass:"cookie-button",attrs:{slot:"reference",type:e.cookieButtonType,size:"mini"},slot:"reference"},[e._v(" "+e._s(e.cookieButtonText)+" ")]),t("div",[t("CookieStatus",{attrs:{"auto-check":!0,"show-cache-info":!0,"show-actions":!0}})],1)],1),e.isLoggedIn?t("div",{staticClass:"user-info"},[t("el-dropdown",{attrs:{trigger:"click"},on:{command:e.handleUserCommand}},[t("span",{staticClass:"user-dropdown"},[t("i",{staticClass:"el-icon-user-solid"}),t("span",[e._v(e._s(e.userInfo.username))]),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{disabled:""}},[t("span",{staticStyle:{color:"#909399"}},[e._v(e._s(e.userInfo.is_premium?"é«˜çº§ç”¨æˆ·":"æ™®é€šç”¨æˆ·"))])]),t("el-dropdown-item",{attrs:{divided:"",command:"logout"}},[t("i",{staticClass:"el-icon-switch-button"}),e._v(" é€€å‡ºç™»å½• ")])],1)],1)],1):t("el-button",{staticClass:"login-button",attrs:{type:"primary",size:"mini"},on:{click:e.handleLogin}},[t("i",{staticClass:"el-icon-user"}),e._v(" ç™»å½• ")])],1)],1)])},o=[],n=(a(4114),a(8111),a(3579),function(){var e=this,t=e._self._c;return t("div",{staticClass:"cookie-status-section"},[t("el-alert",{attrs:{title:e.dynamicCookieStatus.text,type:e.dynamicCookieStatus.type,closable:!1,"show-icon":""}},[t("el-row",{staticClass:"el-el-alert__title",attrs:{type:"flex",align:"middle"}},[e.dynamicCookieStatus.lastModified?t("span",[e._v(" æœ€åŽæ›´æ–°: "+e._s(e.dynamicCookieStatus.lastModified)+" ")]):e._e(),e.getCacheRemainingMinutes>0?t("p",{staticStyle:{"margin-left":"10px",color:"#67c23a"}},[e._v(" â° ç¼“å­˜æœ‰æ•ˆ: "+e._s(e.getCacheRemainingMinutes)+"åˆ†é’Ÿ ")]):e._e()]),t("el-row",{staticClass:"el-alert__description",attrs:{type:"flex",align:"middle"}},[t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text",size:"mini",loading:e.cookieChecking,disabled:e.cookieUpdating},on:{click:e.handleCheckStatus}},[e._v(" ðŸ” æ£€æŸ¥çŠ¶æ€ ")]),t("el-button",{attrs:{type:"text",size:"mini",loading:e.cookieUpdating,disabled:e.cookieChecking},on:{click:e.handleUpdateCookies}},[e._v(" â™»ï¸ æ›´æ–°/ç™»å½• ")])],1)],1)],1)}),u=[],c={name:"CookieStatus",props:{autoCheck:{type:Boolean,default:!0},showCacheInfo:{type:Boolean,default:!0},showActions:{type:Boolean,default:!0}},data(){return{cookiesStatus:{type:"info",text:"æœªæ£€æŸ¥",lastModified:null,server_validated:!1},cookieUpdating:!1,cookieChecking:!1,cookieUpdateTimer:null}},computed:{isCookieCacheValid(){return this.$store.getters["cookie/isCookieCacheValid"]},getCacheRemainingMinutes(){return this.$store.getters["cookie/getCacheRemainingMinutes"]},getCacheExpiryTime(){return this.$store.getters["cookie/getCacheExpiryTime"]},dynamicCookieStatus(){return this.isCookieCacheValid?{type:"success",text:"ðŸª æœ‰æ•ˆ",lastModified:"ç¼“å­˜ä¸­",server_validated:!0}:this.cookiesStatus}},mounted(){this.autoCheck&&this.$nextTick(()=>{this.handleCheckStatus()})},beforeDestroy(){this.stopCookieUpdateMonitoring()},methods:{async handleCheckStatus(){if(!this.cookieChecking)if(this.isCookieCacheValid)console.log("ä½¿ç”¨ ðŸª éªŒè¯ç¼“å­˜ï¼Œè·³è¿‡æœåŠ¡å™¨éªŒè¯");else{this.cookieChecking=!0;try{const e=await this.$api.spider.checkCookie();if(200===e.code){const t=e.data;t.valid?(this.$store.commit("cookie/updateCookieCache",!0),this.cookiesStatus={type:"success",text:"ðŸª æœ‰æ•ˆ",lastModified:t.last_modified||"æœªçŸ¥",server_validated:!0}):(this.$store.commit("cookie/updateCookieCache",!1),this.cookiesStatus={type:"error",text:"ðŸª å·²è¿‡æœŸ",lastModified:t.last_modified||"æœªçŸ¥",server_validated:!1},this.$notify.warning({title:"ðŸª å·²è¿‡æœŸ",message:"éœ€è¦é‡æ–°ç™»å½•"}))}else this.$store.commit("cookie/updateCookieCache",!1),this.cookiesStatus={type:"danger",text:"æ£€æŸ¥å¤±è´¥",lastModified:"æœªçŸ¥",server_validated:!1},this.$notify.error({title:"æ£€æŸ¥å¤±è´¥",message:e.message||"æ£€æŸ¥CookiesçŠ¶æ€å¤±è´¥"});this.$emit("status-change",this.cookiesStatus)}catch(e){this.cookiesStatus={type:"danger",text:"æ£€æŸ¥å¤±è´¥",lastModified:"æœªçŸ¥",server_validated:!1},this.$notify.error({title:"æ£€æŸ¥å¤±è´¥",message:"æ£€æŸ¥ðŸªçŠ¶æ€å¤±è´¥: "+e.message}),this.$emit("status-change",this.cookiesStatus)}finally{this.cookieChecking=!1}}},handleClearCache(){this.$store.dispatch("cookie/clearCookieCache"),this.$notify.info({title:"ç¼“å­˜å·²æ¸…é™¤",message:"CookieéªŒè¯ç¼“å­˜å·²æ¸…é™¤ï¼Œä¸‹æ¬¡æ£€æŸ¥å°†é‡æ–°éªŒè¯"}),this.$emit("cache-cleared")},async handleUpdateCookies(){if(!this.cookieUpdating){this.cookieUpdating=!0;try{this.$notify.info({title:"ðŸª æ›´æ–°",message:"æ­£åœ¨å¯åŠ¨ðŸª æ›´æ–°ç¨‹åºï¼Œè¯·åœ¨å¼¹å‡ºçš„æµè§ˆå™¨ä¸­ç™»å½•..."});const e=await this.$api.spider.updateCookies();if(200!==e.code)throw new Error(e.message||"ðŸª æ›´æ–°å¤±è´¥");this.$notify.info({title:"ðŸª æ›´æ–°",message:"ðŸª æ›´æ–°ç¨‹åºå·²å¯åŠ¨ï¼Œè¯·åœ¨æµè§ˆå™¨ä¸­å®Œæˆç™»å½•æ“ä½œ"}),this.cookiesStatus={type:"warning",text:"ðŸª æ›´æ–°ä¸­...",lastModified:"æœªçŸ¥",server_validated:!1},this.startCookieUpdateMonitoring(),this.$emit("update-started")}catch(e){this.$notify.error("ðŸª æ›´æ–°å¤±è´¥: "+e.message),this.$emit("update-failed",e)}finally{this.cookieUpdating=!1}}},startCookieUpdateMonitoring(){this.cookieUpdateTimer&&clearInterval(this.cookieUpdateTimer);let e=0;const t=60;this.cookieUpdateTimer=setInterval(async()=>{e++;try{const e=await this.$api.spider.getStatus();if(200===e.code){const t=e.data;"completed"===t.status&&t.message.includes("ðŸª æ›´æ–°æˆåŠŸ")?(clearInterval(this.cookieUpdateTimer),this.cookieUpdateTimer=null,this.updateCookieCache(!1),this.$notify.success({title:"ðŸª æ›´æ–°",message:"ðŸª æ›´æ–°æˆåŠŸï¼"}),this.cookiesStatus={type:"success",text:"ðŸª å·²æ›´æ–°",lastModified:"åˆšåˆš",server_validated:!0},await this.handleCheckStatus(),this.$emit("update-completed")):"error"===t.status&&t.message.includes("ðŸª æ›´æ–°å¤±è´¥")&&(clearInterval(this.cookieUpdateTimer),this.cookieUpdateTimer=null,this.$notify.error({title:"ðŸª æ›´æ–°",message:"ðŸª æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•"}),this.cookiesStatus={type:"danger",text:"ðŸª æ›´æ–°å¤±è´¥",lastModified:"æœªçŸ¥",server_validated:!1},this.$emit("update-failed",new Error("ðŸª æ›´æ–°å¤±è´¥")))}}catch(a){console.error("æ£€æŸ¥ ðŸª æ›´æ–°çŠ¶æ€å¤±è´¥:",a)}e>=t&&(clearInterval(this.cookieUpdateTimer),this.cookieUpdateTimer=null,this.$notify.warning({title:"ðŸª æ›´æ–°",message:"ðŸª æ›´æ–°ç›‘æŽ§è¶…æ—¶ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥çŠ¶æ€"}),this.cookiesStatus={type:"warning",text:"ðŸª æ›´æ–°çŠ¶æ€æœªçŸ¥",lastModified:"æœªçŸ¥",server_validated:!1},this.$emit("update-timeout"))},5e3)},stopCookieUpdateMonitoring(){this.cookieUpdateTimer&&(clearInterval(this.cookieUpdateTimer),this.cookieUpdateTimer=null)}}},l=c,d=a(1656),h=(0,d.A)(l,n,u,!1,null,"43b287a4",null),p=h.exports,m={name:"Header",components:{CookieStatus:p},data(){return{userInfo:null,isLoggedIn:!1}},computed:{activeMenuIndex(){const e=this.$route.path;return"/"===e?"/":e.startsWith("/roles/normal")?"/roles/normal/109,175/1":e.startsWith("/roles/empty")?"/roles/empty/109,175/1":e.startsWith("/roles")?"/roles/normal/109,175/1":e.startsWith("/equipments")?"/equipments":e.startsWith("/pets")?"/pets":e.startsWith("/equipment-desc-creator")?"/equipment-desc-creator":e.startsWith("/market-data-status")?"/market-data-status":e.startsWith("/admin/users")?"/admin/users":"/"},isCookieCacheValid(){return this.$store.getters["cookie/isCookieCacheValid"]},getCacheRemainingMinutes(){return this.$store.getters["cookie/getCacheRemainingMinutes"]},cookieButtonType(){return this.isCookieCacheValid?"success":"danger"},cookieButtonIcon(){return this.isCookieCacheValid?"el-icon-check":"el-icon-close"},cookieButtonText(){return this.isCookieCacheValid?"ðŸª æœ‰æ•ˆ":"ðŸª å·²è¿‡æœŸ"}},mounted(){this.checkLoginStatus(),window.addEventListener("auth-required",this.handleAuthRequired),this.updateTimer=setInterval(()=>{this.$forceUpdate()},6e4),this.$watch("$route",e=>{this.checkLoginStatus(),e.matched.some(e=>e.meta.requiresAuth)&&!this.isLoggedIn&&this.$router.push({path:"/login",query:{redirect:e.fullPath}}),this.$forceUpdate()},{immediate:!0})},beforeDestroy(){this.updateTimer&&clearInterval(this.updateTimer),window.removeEventListener("auth-required",this.handleAuthRequired)},methods:{checkLoginStatus(){const e=localStorage.getItem("auth_token"),t=localStorage.getItem("user_info");if(!e||!t)return this.userInfo=null,this.isLoggedIn=!1,!1;try{const e=JSON.parse(t);return e&&e.username?(this.userInfo=e,this.isLoggedIn=!0,!0):(console.warn("ç”¨æˆ·ä¿¡æ¯ä¸å®Œæ•´ï¼Œæ¸…é™¤æœ¬åœ°å­˜å‚¨"),this.clearLocalAuth(),!1)}catch(a){return console.error("è§£æžç”¨æˆ·ä¿¡æ¯å¤±è´¥:",a),this.clearLocalAuth(),!1}},clearLocalAuth(){localStorage.removeItem("auth_token"),localStorage.removeItem("user_info"),this.userInfo=null,this.isLoggedIn=!1},requireLogin(e="è¯·å…ˆç™»å½•"){return!(!this.isLoggedIn||!this.userInfo)||(this.$message.warning(e),this.$router.push({path:"/login",query:{redirect:this.$route.fullPath}}),!1)},handleAuthRequired(){console.log("æ”¶åˆ° auth-required äº‹ä»¶ï¼Œæ¸…é™¤ç™»å½•çŠ¶æ€"),this.clearLocalAuth(),"/login"!==this.$route.path&&(this.$message.warning("ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•"),this.$router.push({path:"/login",query:{redirect:this.$route.fullPath}}))},handleLogin(){this.$router.push({path:"/login",query:{redirect:this.$route.fullPath}})},async handleUserCommand(e){"logout"===e&&await this.handleLogout()},async handleLogout(){try{await this.$api.auth.logout()}catch(e){console.error("é€€å‡ºç™»å½•å¤±è´¥:",e)}finally{this.clearLocalAuth(),this.$message.success("å·²é€€å‡ºç™»å½•"),this.$router.push("/login")}}}},g=m,k=(0,d.A)(g,i,o,!1,null,"446112e4",null),f=k.exports,C={name:"App",components:{Header:f}},v=C,y=(0,d.A)(v,s,r,!1,null,"094f2acd",null),_=y.exports},7120:function(e,t,a){a.d(t,{FH:function(){return v}});a(8111),a(116),a(4603),a(7566),a(8721);var s=a(417),r=a(4927);const i="undefined"!==typeof chrome&&chrome.runtime&&chrome.runtime.id,o=i?"http://xyq.lingtong.xyz/api/v1":"/api/v1";let n="",u=0;const c=3e5;let l=null,d=0;const h=3e5,p=async()=>i?new Promise(e=>{chrome.storage.local.get(["auth_token"],t=>{t.auth_token?(l=t.auth_token,d=Date.now(),e(t.auth_token)):e(null)})}):null,m=()=>{const e=Date.now();return e-d>h&&p().catch(e=>{console.error("æ›´æ–° auth token ç¼“å­˜å¤±è´¥:",e)}),l},g=()=>{l=null,d=0,i&&chrome.storage.local.remove(["auth_token","user_info"])},k=async()=>{if(!i)return"";try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e||!e.url||!e.url.includes("cbg.163.com"))return"";const t=await chrome.debugger.sendCommand({tabId:e.id},"Network.getAllCookies"),a=Array.isArray(t?.cookies)?t.cookies:[],s=a.find(e=>"fingerprint"===e.name&&e.domain&&e.domain.includes("xyq.cbg.163.com"));return s?(n=s.value||"",u=Date.now(),n):""}catch(e){return console.error("èŽ·å– fingerprint cookie å¤±è´¥:",e),""}},f=()=>{const e=Date.now();return e-u>c&&k().catch(e=>{console.error("æ›´æ–° fingerprint cookie ç¼“å­˜å¤±è´¥:",e)}),n},C=s.A.create({baseURL:o,headers:{"Content-Type":"application/json"}});C.interceptors.request.use(async e=>{console.log("å‘é€è¯·æ±‚:",e.method?.toUpperCase(),e.url);const t=f()||"admin";if(t&&(e.headers["X-Fingerprint"]=t),!e.url.includes("/auth/login")&&!e.url.includes("/auth/register")){let t=null;t=i?m():localStorage.getItem("auth_token"),t&&(e.headers["Authorization"]=`Bearer ${t}`)}return e},e=>(console.error("è¯·æ±‚é”™è¯¯:",e),Promise.reject(e))),C.interceptors.response.use(e=>{const{data:t}=e;return t},e=>{console.error("å“åº”é”™è¯¯:",e);let t="è¯·æ±‚å¤±è´¥",a=null;if(e.response){const{status:s,data:r}=e.response;t=r.message||`è¯·æ±‚å¤±è´¥ (${s})`,a=void 0!==r.data?r.data:r,401===s&&(i?(g(),"undefined"!==typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("auth-required"))):(localStorage.removeItem("auth_token"),localStorage.removeItem("user_info"),"undefined"!==typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("auth-required")))),console.log("é”™è¯¯å“åº”æ•°æ®:",a)}else t=e.request?"ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥":e.message||"è¯·æ±‚å¤±è´¥";return r.Notification.error({title:"é”™è¯¯",message:t}),{code:e.response?.status||500,data:a,message:t,timestamp:Date.now()}});const v={get(e,t={}){return C.get(e,{params:t})},post(e,t={}){return C.post(e,t)},put(e,t={}){return C.put(e,t)},delete(e,t={}){return C.delete(e,{params:t})},download(e,t={},a){return C.get(e,{params:t,responseType:"blob"}).then(e=>{if(200===e.code){const t=new Blob([e.data]),s=window.URL.createObjectURL(t),r=document.createElement("a");r.href=s,r.download=a||"download",document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(s)}return e})}}},7385:function(e,t){const a={install(e){e.prototype.$cookieManager={getCache(){return this.$store.state.cookie.cookieValidationCache},setCache(e){this.$store.commit("cookie/updateCookieCache",e)},reset(){this.$store.dispatch("cookie/clearCookieCache")}}}};t.A=a},9105:function(e,t,a){a.d(t,{Ay:function(){return d}});var s=a(7120);const r={getRoleApi(e={}){return s.FH.get("/role/",e)},getRoleDetail(e,t={}){return s.FH.get(`/role/${e}`,t)},deleteRole(e,t={}){return s.FH.delete(`/role/${e}`,t)},switchRoleType(e,t={}){return s.FH.post(`/role/${e}/switch-type`,t)},getRoleValuation(e={}){return s.FH.post("/role/valuation",e)},batchRoleValuation(e={}){return s.FH.post("/role/batch-valuation",e)},updateRoleBasePrice(e={}){return s.FH.post(`/role/${e.eid}/update-base-price`,e)},findRoleAnchors(e={}){return s.FH.post("/role/find-anchors",e)},healthCheck(){return s.FH.get("/role/health")},getRoleStats(e={}){return s.FH.get("/role/stats",e)}},i={getEquipmentList(e={}){return s.FH.get("/equipment/",e)},getEquipmentDetail(e,t={}){return s.FH.get(`/equipment/${e}`,t)},findEquipmentAnchors(e){return s.FH.post("/equipment/anchors",e)},getEquipmentValuation(e){return s.FH.post("/equipment/valuation",e)},batchEquipmentValuation(e){return s.FH.post("/equipment/batch-valuation",e)},deleteEquipment(e,t={}){return s.FH.delete(`/equipment/${e}`,t)},getLingshiConfig(){return s.FH.get("/equipment/lingshi-config")},getWeaponConfig(){return s.FH.get("/equipment/weapon-config")},getPetEquipConfig(){return s.FH.get("/equipment/pet-equip-config")},getEquipConfig(){return s.FH.get("/equipment/equip-config")},markEquipmentAsAbnormal(e){return s.FH.post("/equipment/mark-abnormal",e)},getAbnormalEquipmentList(e={}){return s.FH.get("/equipment/abnormal",e)},updateAbnormalEquipmentStatus(e,t){return s.FH.put(`/equipment/abnormal/${e}`,t)},deleteAbnormalEquipment(e){return s.FH.delete(`/equipment/abnormal/${e}`)},extractFeatures(e){return s.FH.post("/equipment/extract-features",e)},getEquipmentStats(e={}){return s.FH.get("/equipment/stats",e)}};var o=a(2361);const n={getStatus(){return s.FH.get("/spider/status")},getConfig(){return s.FH.get("/spider/config")},startBasic(e){return s.FH.post("/spider/basic/start",e)},startRole(e){return s.FH.post("/spider/role/start",e)},startEquip(e){return s.FH.post("/spider/equip/start",e)},startPet(e){return s.FH.post("/spider/pet/start",e)},startProxy(e){return s.FH.post("/spider/proxy/start",e)},manageProxy(e={}){return s.FH.post("/spider/proxy/manage",e)},stopTask(){return s.FH.post("/spider/task/stop")},resetTask(){return s.FH.post("/spider/task/reset")},getLogs(e={}){return s.FH.get("/spider/logs",e)},getProgress(e={}){return s.FH.get("/spider/progress",e)},streamLogs(){const e=window.location.origin;return new EventSource(`${e}/api/v1/spider/logs/stream`)},getFiles(){return s.FH.get("/spider/files")},getLogFiles(){return s.FH.get("/spider/logs/files")},downloadFile(e){return s.FH.download(`/spider/download/${e}`,{},e)},startPlaywright(e){return s.FH.post("/spider/playwright/start",e)},checkCookie(){return s.FH.get("/spider/cookie/check")},updateCookies(){return s.FH.post("/spider/cookie/update")},parseResponse(e){return s.FH.post("/spider/parse/response",e)}};var u=a(3443);const c={getUserList(e={}){return s.FH.get("/admin/users",e)},getUserDetail(e){return s.FH.get(`/admin/users/${e}`)},activateUser(e){return s.FH.post(`/admin/users/${e}/activate`)},deactivateUser(e){return s.FH.post(`/admin/users/${e}/deactivate`)},setPremium(e,t=!0){return s.FH.post(`/admin/users/${e}/set-premium`,{is_premium:t})}},l={login(e){return s.FH.post("/auth/login",e)},register(e){return s.FH.post("/auth/register",e)},logout(){return s.FH.post("/auth/logout")},getCurrentUser(){return s.FH.get("/auth/me")},refreshToken(){return s.FH.post("/auth/refresh-token")},updateFingerprint(e){return s.FH.post("/auth/update-fingerprint",e)}};var d={role:r,equipment:i,pet:o.g,spider:n,system:u.u,admin:c,auth:l}}}]);
//# sourceMappingURL=chunk-common.d3d457a1.js.map