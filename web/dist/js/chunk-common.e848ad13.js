"use strict";(self["webpackChunkweb"]=self["webpackChunkweb"]||[]).push([[996],{3803:function(e,t,a){a.d(t,{u:function(){return i}});var s=a(5720);const i={getSystemInfo(){return s.F.get("/system/info")},getFiles(){return s.F.get("/system/files")},downloadFile(e){return s.F.get(`/system/files/${e}/download`)},getHotServers(){return s.F.get("/system/config-file/hot_server_list.json")},getLimitedSkinConfig(){return s.F.get("/system/config-file/ex_avt_value.jsonc")},getSearchParams(){return s.F.get("/system/config/search-params")},getSearchParamByType(e){return s.F.get(`/system/config/search-params/${e}`)},updateSearchParam(e,t){return s.F.post(`/system/config/search-params/${e}`,t)},getMarketDataStatus(){return s.F.get("/system/market-data/status")},getMarketDataAnalysis(){return s.F.get("/system/market-data/analysis")},refreshMarketData(){return s.F.post("/system/market-data/refresh",{force_refresh:!1,use_cache:!0})},refreshFullCache(){return s.F.post("/system/market-data/refresh",{force_refresh:!0,use_cache:!0})},getRoleRefreshStatus(){return s.F.get("/system/market-data/role/refresh-status")},getCacheStatus(){return s.F.get("/system/market-data/cache-status")},getEquipmentCacheStatus(){return s.F.get("/system/market-data/equipment/cache-status")},refreshEquipmentData(){return s.F.post("/system/market-data/equipment/refresh",{force_refresh:!1,use_cache:!0})},refreshEquipmentFullCache(){return s.F.post("/system/market-data/equipment/refresh",{force_refresh:!0,use_cache:!0})},getEquipmentMarketDataStatus(){return s.F.get("/system/market-data/equipment/status")},getRedisStatus(){return s.F.get("/system/redis/status")},getEquipmentRefreshStatus(){return s.F.get("/system/market-data/equipment/refresh-status")},getPetCacheStatus(){return s.F.get("/system/market-data/pet/cache-status")},getPetMarketDataStatus(){return s.F.get("/system/market-data/pet/status")},refreshPetData(){return s.F.post("/system/market-data/pet/refresh",{force_refresh:!1,use_cache:!0})},refreshPetFullCache(){return s.F.post("/system/market-data/pet/refresh",{force_refresh:!0,use_cache:!0})},getPetRefreshStatus(){return s.F.get("/system/market-data/pet/refresh-status")},getSystemStats(){return s.F.get("/system/stats")}}},4096:function(e,t,a){a.d(t,{A:function(){return _}});var s=function(){var e=this,t=e._self._c;return t("el-container",[e.$route.meta.showHeader?t("Header"):e._e(),t("el-main",{style:{padding:e.$route.meta.showHeader?"20px":"0"}},[t("router-view")],1)],1)},i=[],r=function(){var e=this,t=e._self._c;return t("el-header",[t("div",{staticClass:"header-content"},[t("el-menu",{attrs:{mode:"horizontal",router:!0,"default-active":e.activeMenuIndex}},[t("el-menu-item",{attrs:{index:"/"}},[e._v("🏠️"),t("span",{staticClass:"menu-item-text"},[e._v("首页")])]),t("el-menu-item",{attrs:{index:"/roles/normal/109,175/1"}},[e._v("👥"),t("span",{staticClass:"menu-item-text"},[e._v("角色")])]),t("el-menu-item",{attrs:{index:"/roles/empty/109,175/1"}},[e._v("🎯"),t("span",{staticClass:"menu-item-text"},[e._v("空号")])]),t("el-menu-item",{attrs:{index:"/equipments"}},[e._v("⚔️"),t("span",{staticClass:"menu-item-text"},[e._v("装备")])]),t("el-menu-item",{attrs:{index:"/pets"}},[e._v("🐲"),t("span",{staticClass:"menu-item-text"},[e._v("召唤兽")])]),t("el-menu-item",{attrs:{index:"/equipment-desc-creator"}},[e._v("🔨"),t("span",{staticClass:"menu-item-text"},[e._v("装备模拟")])]),t("el-menu-item",{attrs:{index:"/market-data-status"}},[e._v("📊"),t("span",{staticClass:"menu-item-text"},[e._v("数据状态")])])],1),t("el-popover",{attrs:{placement:"bottom",width:"400",trigger:"click","popper-class":"cookie-popover","visible-arrow":!1}},[t("el-button",{staticClass:"cookie-button",attrs:{slot:"reference",type:e.cookieButtonType,size:"mini"},slot:"reference"},[e._v(" "+e._s(e.cookieButtonText)+" ")]),t("div",[t("CookieStatus",{attrs:{"auto-check":!0,"show-cache-info":!0,"show-actions":!0}})],1)],1)],1)])},o=[],n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"cookie-status-section"},[t("el-alert",{attrs:{title:e.dynamicCookieStatus.text,type:e.dynamicCookieStatus.type,closable:!1,"show-icon":""}},[t("el-row",{staticClass:"el-el-alert__title",attrs:{type:"flex",align:"middle"}},[e.dynamicCookieStatus.lastModified?t("span",[e._v(" 最后更新: "+e._s(e.dynamicCookieStatus.lastModified)+" ")]):e._e(),e.getCacheRemainingMinutes>0?t("p",{staticStyle:{"margin-left":"10px",color:"#67c23a"}},[e._v(" ⏰ 缓存有效: "+e._s(e.getCacheRemainingMinutes)+"分钟 ")]):e._e()]),t("el-row",{staticClass:"el-alert__description",attrs:{type:"flex",align:"middle"}},[t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text",size:"mini",loading:e.cookieChecking,disabled:e.cookieUpdating},on:{click:e.handleCheckStatus}},[e._v(" 🔍 检查状态 ")]),t("el-button",{attrs:{type:"text",size:"mini",loading:e.cookieUpdating,disabled:e.cookieChecking},on:{click:e.handleUpdateCookies}},[e._v(" ♻️ 更新/登录 ")])],1)],1)],1)},c=[],u={name:"CookieStatus",props:{autoCheck:{type:Boolean,default:!0},showCacheInfo:{type:Boolean,default:!0},showActions:{type:Boolean,default:!0}},data(){return{cookiesStatus:{type:"info",text:"未检查",lastModified:null,server_validated:!1},cookieUpdating:!1,cookieChecking:!1,cookieUpdateTimer:null}},computed:{isCookieCacheValid(){return this.$store.getters["cookie/isCookieCacheValid"]},getCacheRemainingMinutes(){return this.$store.getters["cookie/getCacheRemainingMinutes"]},getCacheExpiryTime(){return this.$store.getters["cookie/getCacheExpiryTime"]},dynamicCookieStatus(){return this.isCookieCacheValid?{type:"success",text:"🍪 有效",lastModified:"缓存中",server_validated:!0}:this.cookiesStatus}},mounted(){this.autoCheck&&this.$nextTick((()=>{this.handleCheckStatus()}))},beforeDestroy(){this.stopCookieUpdateMonitoring()},methods:{async handleCheckStatus(){if(!this.cookieChecking)if(this.isCookieCacheValid)console.log("使用 🍪 验证缓存，跳过服务器验证");else{this.cookieChecking=!0;try{const e=await this.$api.spider.checkCookie();if(200===e.code){const t=e.data;t.valid?(this.$store.commit("cookie/updateCookieCache",!0),this.cookiesStatus={type:"success",text:"🍪 有效",lastModified:t.last_modified||"未知",server_validated:!0}):(this.$store.commit("cookie/updateCookieCache",!1),this.cookiesStatus={type:"error",text:"🍪 已过期",lastModified:t.last_modified||"未知",server_validated:!1},this.$notify.warning({title:"🍪 已过期",message:"需要重新登录"}))}else this.$store.commit("cookie/updateCookieCache",!1),this.cookiesStatus={type:"danger",text:"检查失败",lastModified:"未知",server_validated:!1},this.$notify.error({title:"检查失败",message:e.message||"检查Cookies状态失败"});this.$emit("status-change",this.cookiesStatus)}catch(e){this.cookiesStatus={type:"danger",text:"检查失败",lastModified:"未知",server_validated:!1},this.$notify.error({title:"检查失败",message:"检查🍪状态失败: "+e.message}),this.$emit("status-change",this.cookiesStatus)}finally{this.cookieChecking=!1}}},handleClearCache(){this.$store.dispatch("cookie/clearCookieCache"),this.$notify.info({title:"缓存已清除",message:"Cookie验证缓存已清除，下次检查将重新验证"}),this.$emit("cache-cleared")},async handleUpdateCookies(){if(!this.cookieUpdating){this.cookieUpdating=!0;try{this.$notify.info({title:"🍪 更新",message:"正在启动🍪 更新程序，请在弹出的浏览器中登录..."});const e=await this.$api.spider.updateCookies();if(200!==e.code)throw new Error(e.message||"🍪 更新失败");this.$notify.info({title:"🍪 更新",message:"🍪 更新程序已启动，请在浏览器中完成登录操作"}),this.cookiesStatus={type:"warning",text:"🍪 更新中...",lastModified:"未知",server_validated:!1},this.startCookieUpdateMonitoring(),this.$emit("update-started")}catch(e){this.$notify.error("🍪 更新失败: "+e.message),this.$emit("update-failed",e)}finally{this.cookieUpdating=!1}}},startCookieUpdateMonitoring(){this.cookieUpdateTimer&&clearInterval(this.cookieUpdateTimer);let e=0;const t=60;this.cookieUpdateTimer=setInterval((async()=>{e++;try{const e=await this.$api.spider.getStatus();if(200===e.code){const t=e.data;"completed"===t.status&&t.message.includes("🍪 更新成功")?(clearInterval(this.cookieUpdateTimer),this.cookieUpdateTimer=null,this.updateCookieCache(!1),this.$notify.success({title:"🍪 更新",message:"🍪 更新成功！"}),this.cookiesStatus={type:"success",text:"🍪 已更新",lastModified:"刚刚",server_validated:!0},await this.handleCheckStatus(),this.$emit("update-completed")):"error"===t.status&&t.message.includes("🍪 更新失败")&&(clearInterval(this.cookieUpdateTimer),this.cookieUpdateTimer=null,this.$notify.error({title:"🍪 更新",message:"🍪 更新失败，请重试"}),this.cookiesStatus={type:"danger",text:"🍪 更新失败",lastModified:"未知",server_validated:!1},this.$emit("update-failed",new Error("🍪 更新失败")))}}catch(a){console.error("检查 🍪 更新状态失败:",a)}e>=t&&(clearInterval(this.cookieUpdateTimer),this.cookieUpdateTimer=null,this.$notify.warning({title:"🍪 更新",message:"🍪 更新监控超时，请手动检查状态"}),this.cookiesStatus={type:"warning",text:"🍪 更新状态未知",lastModified:"未知",server_validated:!1},this.$emit("update-timeout"))}),5e3)},stopCookieUpdateMonitoring(){this.cookieUpdateTimer&&(clearInterval(this.cookieUpdateTimer),this.cookieUpdateTimer=null)}}},l=u,d=a(1656),p=(0,d.A)(l,n,c,!1,null,"43b287a4",null),m=p.exports,h={name:"Header",components:{CookieStatus:m},computed:{activeMenuIndex(){const e=this.$route.path;return"/"===e?"/":e.startsWith("/roles/normal")?"/roles/normal/109,175/1":e.startsWith("/roles/empty")?"/roles/empty/109,175/1":e.startsWith("/roles")?"/roles/normal/109,175/1":e.startsWith("/equipments")?"/equipments":e.startsWith("/pets")?"/pets":e.startsWith("/equipment-desc-creator")?"/equipment-desc-creator":e.startsWith("/market-data-status")?"/market-data-status":"/"},isCookieCacheValid(){return this.$store.getters["cookie/isCookieCacheValid"]},getCacheRemainingMinutes(){return this.$store.getters["cookie/getCacheRemainingMinutes"]},cookieButtonType(){return this.isCookieCacheValid?"success":"danger"},cookieButtonIcon(){return this.isCookieCacheValid?"el-icon-check":"el-icon-close"},cookieButtonText(){return this.isCookieCacheValid?"🍪 有效":"🍪 已过期"}},mounted(){this.updateTimer=setInterval((()=>{this.$forceUpdate()}),6e4),this.$watch("$route",(()=>{this.$forceUpdate()}),{immediate:!0})},beforeDestroy(){this.updateTimer&&clearInterval(this.updateTimer)}},g=h,k=(0,d.A)(g,r,o,!1,null,"031375db",null),f=k.exports,C={name:"App",components:{Header:f}},v=C,y=(0,d.A)(v,s,i,!1,null,"ce23e902",null),_=y.exports},4545:function(e,t,a){a.d(t,{g:function(){return i}});var s=a(5720);const i={getPetList(e={}){return s.F.get("/pet/",e)},getPetDetail(e,t={}){return s.F.get(`/pet/${e}`,t)},findPetAnchors(e){return s.F.post("/pet/anchors",e)},getPetValuation(e){return s.F.post("/pet/valuation",e)},batchPetValuation(e){return s.F.post("/pet/batch-valuation",e)},updatePetEquipmentsPrice(e){return s.F.post("/pet/update-equipments-price",e)},getUnvaluedPetsCount(e={}){return s.F.get("/pet/unvalued-count",e)},batchUpdateUnvaluedPets(e={}){return s.F.post("/pet/batch-update-unvalued",e)},getTaskStatus(e){return s.F.get(`/pet/task-status/${e}`)},getActiveTasks(){return s.F.get("/pet/active-tasks")},stopTask(e){return s.F.post(`/pet/stop-task/${e}`)},deletePet(e,t={}){return s.F.delete(`/pet/${e}`,t)},getPetByEquipSn(e,t,a){return s.F.get(`/pet/${e}/${t}/${a}`)},getPetStats(e={}){return s.F.get("/pet/stats",e)}}},4769:function(e,t){const a={install(e){e.prototype.$cookieManager={getCache(){return this.$store.state.cookie.cookieValidationCache},setCache(e){this.$store.commit("cookie/updateCookieCache",e)},reset(){this.$store.dispatch("cookie/clearCookieCache")}}}};t.A=a},5129:function(e,t,a){var s=a(6848),i=a(3518),r=a(5131);s["default"].use(i.Ay);const o={namespaced:!0,state:{cookieValidationCache:{lastValidTime:null,cacheDuration:3e5,isValid:!1}},getters:{isCookieCacheValid:e=>{if(!e.cookieValidationCache.isValid||!e.cookieValidationCache.lastValidTime)return!1;const t=Date.now(),a=t-e.cookieValidationCache.lastValidTime;return a<e.cookieValidationCache.cacheDuration},getCacheRemainingMinutes:e=>{if(!e.cookieValidationCache.isValid||!e.cookieValidationCache.lastValidTime)return 0;const t=Date.now(),a=t-e.cookieValidationCache.lastValidTime,s=e.cookieValidationCache.cacheDuration-a;return s<=0?0:Math.ceil(s/6e4)},getCacheExpiryTime:e=>e.cookieValidationCache.isValid&&e.cookieValidationCache.lastValidTime?new Date(e.cookieValidationCache.lastValidTime+e.cookieValidationCache.cacheDuration):null,getCookieCache:e=>e.cookieValidationCache},mutations:{updateCookieCache(e,t){e.cookieValidationCache.isValid=t,t?(e.cookieValidationCache.lastValidTime=Date.now(),console.log("Cookie验证缓存已更新，有效期5分钟")):(e.cookieValidationCache.lastValidTime=null,console.log("Cookie验证缓存已清除"))}},actions:{clearCookieCache({commit:e}){e("updateCookieCache",!1)},cleanExpiredCache({commit:e,getters:t}){t.isCookieCacheValid||(e("updateCookieCache",!1),console.log("过期缓存已自动清理"))}}};t.A=new i.Ay.Store({state:{areaid:43,server_id:77,server_name:"进贤门",server_data_value:[43,77]},getters:{getCurrentServerData:e=>({areaid:e.areaid,server_id:e.server_id,server_name:e.server_name,server_data_value:e.server_data_value})},mutations:{updateServerData(e,{areaid:t,server_id:a,server_name:s}){e.areaid=t,e.server_id=a,e.server_name=s,e.server_data_value=[t,a]},updateServerDataValue(e,t){if(Array.isArray(t)&&t.length>=2){if(e.server_data_value=t,e.areaid=t[0],e.server_id=t[1],window.server_data)for(let a in window.server_data){let[s,i]=window.server_data[a];const[,,,,r]=s;if(r===t[0]){for(let a of i)if(a[0]===t[1]){e.server_name=a[1];break}break}}}else e.server_data_value=[43,77],e.areaid=43,e.server_id=77,e.server_name="进贤门"}},actions:{setServerData({commit:e},{areaid:t,server_id:a,server_name:s}){e("updateServerData",{areaid:t,server_id:a,server_name:s})},setServerDataValue({commit:e},t){e("updateServerDataValue",t)}},modules:{cookie:o},plugins:[(0,r.A)({key:"cbg-cookie-cache",storage:window.localStorage})]})},5720:function(e,t,a){a.d(t,{F:function(){return c}});var s=a(4373),i=a(9143);const r="undefined"!==typeof chrome&&chrome.runtime&&chrome.runtime.id,o=r?"http://xyq.lingtong.xyz/cbg/api/v1":"/api/v1",n=s.A.create({baseURL:o,headers:{"Content-Type":"application/json"}});n.interceptors.request.use((e=>(console.log("发送请求:",e.method?.toUpperCase(),e.url),e)),(e=>(console.error("请求错误:",e),Promise.reject(e)))),n.interceptors.response.use((e=>{const{data:t}=e;return t}),(e=>{console.error("响应错误:",e);let t="请求失败",a=null;if(e.response){const{status:s,data:i}=e.response;t=i.message||`请求失败 (${s})`,a=void 0!==i.data?i.data:i,console.log("错误响应数据:",a)}else t=e.request?"网络错误，请检查网络连接":e.message||"请求失败";return i.Notification.error({title:"错误",message:t}),{code:e.response?.status||500,data:a,message:t,timestamp:Date.now()}}));const c={get(e,t={}){return n.get(e,{params:t})},post(e,t={}){return n.post(e,t)},put(e,t={}){return n.put(e,t)},delete(e,t={}){return n.delete(e,{params:t})},download(e,t={},a){return n.get(e,{params:t,responseType:"blob"}).then((e=>{if(200===e.code){const t=new Blob([e.data]),s=window.URL.createObjectURL(t),i=document.createElement("a");i.href=s,i.download=a||"download",document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(s)}return e}))}}},6695:function(e,t,a){a.d(t,{Ay:function(){return u}});var s=a(5720);const i={getRoleApi(e={}){return s.F.get("/role/",e)},getRoleDetail(e,t={}){return s.F.get(`/role/${e}`,t)},deleteRole(e,t={}){return s.F.delete(`/role/${e}`,t)},switchRoleType(e,t={}){return s.F.post(`/role/${e}/switch-type`,t)},getRoleValuation(e={}){return s.F.post("/role/valuation",e)},batchRoleValuation(e={}){return s.F.post("/role/batch-valuation",e)},updateRoleBasePrice(e={}){return s.F.post(`/role/${e.eid}/update-base-price`,e)},findRoleAnchors(e={}){return s.F.post("/role/find-anchors",e)},healthCheck(){return s.F.get("/role/health")},getRoleStats(e={}){return s.F.get("/role/stats",e)}},r={getEquipmentList(e={}){return s.F.get("/equipment/",e)},getEquipmentDetail(e,t={}){return s.F.get(`/equipment/${e}`,t)},findEquipmentAnchors(e){return s.F.post("/equipment/anchors",e)},getEquipmentValuation(e){return s.F.post("/equipment/valuation",e)},batchEquipmentValuation(e){return s.F.post("/equipment/batch-valuation",e)},deleteEquipment(e,t={}){return s.F.delete(`/equipment/${e}`,t)},getLingshiConfig(){return s.F.get("/equipment/lingshi-config")},getWeaponConfig(){return s.F.get("/equipment/weapon-config")},getPetEquipConfig(){return s.F.get("/equipment/pet-equip-config")},getEquipConfig(){return s.F.get("/equipment/equip-config")},markEquipmentAsAbnormal(e){return s.F.post("/equipment/mark-abnormal",e)},getAbnormalEquipmentList(e={}){return s.F.get("/equipment/abnormal",e)},updateAbnormalEquipmentStatus(e,t){return s.F.put(`/equipment/abnormal/${e}`,t)},deleteAbnormalEquipment(e){return s.F.delete(`/equipment/abnormal/${e}`)},extractFeatures(e){return s.F.post("/equipment/extract-features",e)},getEquipmentStats(e={}){return s.F.get("/equipment/stats",e)}};var o=a(4545);const n={getStatus(){return s.F.get("/spider/status")},getConfig(){return s.F.get("/spider/config")},startBasic(e){return s.F.post("/spider/basic/start",e)},startRole(e){return s.F.post("/spider/role/start",e)},startEquip(e){return s.F.post("/spider/equip/start",e)},startPet(e){return s.F.post("/spider/pet/start",e)},startProxy(e){return s.F.post("/spider/proxy/start",e)},manageProxy(e={}){return s.F.post("/spider/proxy/manage",e)},stopTask(){return s.F.post("/spider/task/stop")},resetTask(){return s.F.post("/spider/task/reset")},getLogs(e={}){return s.F.get("/spider/logs",e)},getProgress(e={}){return s.F.get("/spider/progress",e)},streamLogs(){const e=window.location.origin;return new EventSource(`${e}/api/v1/spider/logs/stream`)},getFiles(){return s.F.get("/spider/files")},getLogFiles(){return s.F.get("/spider/logs/files")},downloadFile(e){return s.F.download(`/spider/download/${e}`,{},e)},startPlaywright(e){return s.F.post("/spider/playwright/start",e)},checkCookie(){return s.F.get("/spider/cookie/check")},updateCookies(){return s.F.post("/spider/cookie/update")},parseResponse(e){return s.F.post("/spider/parse/response",e)}};var c=a(3803),u={role:i,equipment:r,pet:o.g,spider:n,system:c.u}}}]);
//# sourceMappingURL=chunk-common.e848ad13.js.map