# Playwright半自动数据收集器使用指南

## 🎯 功能概述

Playwright收集器是一个半自动的数据收集工具，它结合了自动化浏览器控制和手动操作的优势：

- **🎨 半自动模式**：浏览器自动打开并访问目标页面，用户手动操作
- **🔄 实时监听**：无需JavaScript注入，页面刷新不影响监听
- **🎯 智能分类**：自动识别角色、装备、宠物等数据类型
- **🍪 Cookie管理**：自动注入和更新登录状态
- **🚪 自动停止**：关闭浏览器时自动停止收集服务

## 🚀 快速开始

### 1. 前端界面操作

1. 打开CBG爬虫系统前端页面
2. 点击 **"🎯 Playwright收集器"** 标签
3. 配置收集器参数：
   - **无头模式**：选择是否显示浏览器界面
   - **目标URL**：选择预设URL或输入自定义URL
   - **Cookie状态**：检查登录状态
4. 点击 **"🚀 启动Playwright收集器"** 按钮

### 2. 浏览器操作

1. 浏览器会自动打开并访问目标页面
2. 如果未登录，请在浏览器中手动登录您的藏宝阁账号
3. 登录成功后，在CBG网站中正常搜索角色、装备、宠物等
4. 所有API请求将被自动捕获并保存到对应数据库
5. 关闭浏览器窗口即可自动停止收集服务

## ⚙️ 配置选项

### 目标URL选择

- **角色推荐搜索**：`https://xyq.cbg.163.com/cgi-bin/query.py?act=recommend_search&recommend_type=1`
- **装备推荐搜索**：`https://xyq.cbg.163.com/cgi-bin/query.py?act=recommend_search&recommend_type=2`
- **宠物推荐搜索**：`https://xyq.cbg.163.com/cgi-bin/query.py?act=recommend_search&recommend_type=3`
- **自定义URL**：输入完整的CBG URL

### 浏览器模式

- **有头模式**：显示浏览器界面，可以看到操作过程
- **无头模式**：浏览器在后台运行，不显示界面

### Cookie管理

- **自动检查**：系统会自动检查Cookie文件状态
- **状态显示**：显示Cookie是否有效、是否过期等信息
- **自动更新**：登录成功后自动更新Cookie文件

## 📊 数据收集

### 自动分类

收集器会根据请求URL自动分类数据：

- **角色数据**：保存到 `cbg_characters_YYYYMM.db`
- **装备数据**：保存到 `cbg_equip_YYYYMM.db`
- **宠物数据**：保存到 `cbg_pets_YYYYMM.db`

### 数据格式

所有数据都按照原有的数据库结构保存，与手动爬虫完全兼容。

## 🔧 命令行使用

也可以通过命令行直接使用：

```bash
# 启动Playwright收集器（有头模式）
python run.py playwright

# 启动Playwright收集器（无头模式）
python run.py playwright --headless

# 指定目标URL
python run.py playwright --target-url https://xyq.cbg.163.com/cgi-bin/query.py?act=recommend_search&recommend_type=1
```

## 📝 操作流程

### 典型使用场景

1. **角色数据收集**
   - 选择"角色推荐搜索"或自定义角色搜索URL
   - 启动收集器，浏览器打开角色搜索页面
   - 在浏览器中设置筛选条件（等级、价格、门派等）
   - 点击搜索，系统自动捕获所有角色数据

2. **装备数据收集**
   - 选择"装备推荐搜索"或自定义装备搜索URL
   - 启动收集器，浏览器打开装备搜索页面
   - 在浏览器中设置装备类型、等级、价格等条件
   - 点击搜索，系统自动捕获所有装备数据

3. **宠物数据收集**
   - 选择"宠物推荐搜索"或自定义宠物搜索URL
   - 启动收集器，浏览器打开宠物搜索页面
   - 在浏览器中设置宠物类型、技能、资质等条件
   - 点击搜索，系统自动捕获所有宠物数据

## ⚠️ 注意事项

1. **登录状态**：首次使用需要手动登录，后续会自动使用保存的Cookie
2. **网络稳定**：确保网络连接稳定，避免请求中断
3. **浏览器兼容**：使用Chromium内核，兼容性良好
4. **数据安全**：所有数据都保存在本地，不会上传到外部服务器

## 🛠️ 故障排除

### 常见问题

1. **浏览器无法启动**
   - 检查是否安装了Playwright：`playwright install chromium`
   - 检查系统权限和防火墙设置

2. **Cookie无效**
   - 重新登录藏宝阁账号
   - 检查Cookie文件是否被删除或损坏

3. **数据未保存**
   - 检查数据库文件权限
   - 查看日志文件了解详细错误信息

4. **网络监听失败**
   - 检查目标URL是否可访问
   - 确认网络连接正常

### 日志查看

所有操作日志都会保存到 `output/` 目录下，可以通过前端界面的日志监控功能查看实时日志。

## 🎉 优势特点

相比传统爬虫，Playwright收集器具有以下优势：

1. **🎯 精确捕获**：基于网络监听，确保数据完整性
2. **🔄 实时响应**：无需等待页面加载完成
3. **🎨 用户友好**：可视化操作，易于理解和使用
4. **🔒 安全可靠**：不依赖页面结构，抗反爬虫能力强
5. **⚡ 高效稳定**：基于Playwright框架，性能优异

---

**开始使用Playwright收集器，体验更智能的数据收集方式！** 🚀 