<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevToolsé€šä¿¡æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #40a9ff;
        }
        .log-area {
            background: #f8f8f8;
            border: 1px solid #e0e0e0;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.success { background: #f6ffed; color: #52c41a; }
        .status.error { background: #fff2f0; color: #ff4d4f; }
        .status.info { background: #e6f7ff; color: #1890ff; }
    </style>
</head>
<body>
    <h1>CBGçˆ¬è™«åŠ©æ‰‹ - DevToolsé€šä¿¡æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>é€šä¿¡æµç¨‹è¯´æ˜</h2>
        <p>è¿™ä¸ªæµ‹è¯•é¡µé¢æ¨¡æ‹Ÿäº†DevToolsæ‰©å±•çš„é€šä¿¡æµç¨‹ï¼š</p>
        <ol>
            <li><strong>devtools.js</strong> ç›‘å¬ç½‘ç»œè¯·æ±‚ï¼Œå½“æ£€æµ‹åˆ°CBG APIè¯·æ±‚æ—¶è°ƒç”¨ <code>handleResponseReceived</code></li>
            <li><strong>handleResponseReceived</strong> é€šè¿‡ <code>chrome.runtime.sendMessage</code> å‘é€æ¶ˆæ¯åˆ° background.js</li>
            <li><strong>background.js</strong> æ¥æ”¶æ¶ˆæ¯å¹¶è½¬å‘åˆ°æ‰€æœ‰DevToolsé¢æ¿</li>
            <li><strong>DevToolsPanel.vue</strong> é€šè¿‡ <code>chrome.runtime.onMessage</code> ç›‘å¬æ¶ˆæ¯å¹¶æ›´æ–°UI</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>æ¨¡æ‹Ÿæµ‹è¯•</h2>
        <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æ¥æ¨¡æ‹Ÿä¸åŒçš„é€šä¿¡åœºæ™¯ï¼š</p>
        
        <button class="test-button" onclick="simulateRequestWillBeSent()">
            æ¨¡æ‹Ÿè¯·æ±‚å‘é€
        </button>
        
        <button class="test-button" onclick="simulateResponseReceived()">
            æ¨¡æ‹Ÿå“åº”æ¥æ”¶
        </button>
        
        <button class="test-button" onclick="simulateLoadingFinished()">
            æ¨¡æ‹ŸåŠ è½½å®Œæˆ
        </button>
        
        <button class="test-button" onclick="simulateDebuggerWarning()">
            æ¨¡æ‹Ÿè°ƒè¯•å™¨å†²çªè­¦å‘Š
        </button>
        
        <button class="test-button" onclick="clearLogs()">
            æ¸…ç©ºæ—¥å¿—
        </button>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•æ—¥å¿—</h2>
        <div id="logArea" class="log-area"></div>
    </div>

    <div class="test-section">
        <h2>é¢„æœŸç»“æœ</h2>
        <p>å¦‚æœé€šä¿¡æ­£å¸¸ï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š</p>
        <ul>
            <li>DevToolsé¢æ¿ä¸­æ˜¾ç¤ºæ£€æµ‹åˆ°çš„è¯·æ±‚åˆ—è¡¨</li>
            <li>è¯·æ±‚çŠ¶æ€ä» "pending" å˜ä¸º "completed"</li>
            <li>å“åº”æ•°æ®èƒ½å¤Ÿæ­£ç¡®æ˜¾ç¤ºå’Œå±•å¼€</li>
            <li>æ¸…ç©ºæ•°æ®åŠŸèƒ½æ­£å¸¸å·¥ä½œ</li>
        </ul>
    </div>

    <script>
        let logCount = 0;
        
        function log(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `
                <span class="status ${type}">[${timestamp}]</span> ${message}
            `;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
            logCount++;
        }
        
        function simulateRequestWillBeSent() {
            log('ğŸ” æ¨¡æ‹Ÿ handleRequestWillBeSent è¢«è°ƒç”¨', 'info');
            log('æ£€æµ‹åˆ°CBG APIè¯·æ±‚: https://cbg.163.com/api/recommend.py?server_id=1&page=1', 'info');
            
            // æ¨¡æ‹Ÿå‘é€æ¶ˆæ¯åˆ°background
            const requestData = {
                requestId: 'test_' + Date.now(),
                url: 'https://cbg.163.com/api/recommend.py?server_id=1&page=1',
                method: 'GET',
                timestamp: Date.now(),
                status: 'pending'
            };
            
            log(`å‘é€æ¶ˆæ¯åˆ°background: updateRecommendData`, 'info');
            log(`æ•°æ®: ${JSON.stringify(requestData, null, 2)}`, 'info');
        }
        
        function simulateResponseReceived() {
            log('ğŸ“¥ æ¨¡æ‹Ÿ handleResponseReceived è¢«è°ƒç”¨', 'info');
            log('æ£€æµ‹åˆ°CBG APIå“åº”: https://cbg.163.com/api/recommend.py?server_id=1&page=1', 'info');
            
            const responseData = {
                requestId: 'test_' + Date.now(),
                response: {
                    status: 200,
                    statusText: 'OK',
                    timestamp: Date.now()
                },
                status: 'completed'
            };
            
            log(`æ›´æ–°è¯·æ±‚çŠ¶æ€ä¸º completed`, 'success');
            log(`å“åº”æ•°æ®: ${JSON.stringify(responseData, null, 2)}`, 'info');
        }
        
        function simulateLoadingFinished() {
            log('ğŸ“¦ æ¨¡æ‹Ÿ handleLoadingFinished è¢«è°ƒç”¨', 'info');
            log('è·å–å“åº”å†…å®¹æˆåŠŸ', 'success');
            
            const mockResponseData = {
                code: 200,
                data: {
                    items: [
                        { id: 1, name: 'æµ‹è¯•è£…å¤‡1', price: 1000 },
                        { id: 2, name: 'æµ‹è¯•è£…å¤‡2', price: 2000 }
                    ],
                    total: 2
                },
                message: 'success'
            };
            
            log(`è§£æå“åº”å†…å®¹: ${JSON.stringify(mockResponseData, null, 2)}`, 'info');
            log('DevToolsPanelåº”è¯¥æ”¶åˆ° updateRecommendData æ¶ˆæ¯å¹¶æ›´æ–°UI', 'success');
        }
        
        function simulateDebuggerWarning() {
            log('âš ï¸ æ¨¡æ‹Ÿè°ƒè¯•å™¨å†²çªè­¦å‘Š', 'error');
            log('æ£€æµ‹åˆ°å…¶ä»–è°ƒè¯•å™¨å·²è¿æ¥ï¼Œè¯·å…³é—­Chromeå¼€å‘è€…å·¥å…·åé‡æ–°åŠ è½½é¡µé¢', 'error');
            log('DevToolsPanelåº”è¯¥æ˜¾ç¤ºè­¦å‘Šæ¶ˆæ¯', 'info');
        }
        
        function clearLogs() {
            document.getElementById('logArea').innerHTML = '';
            logCount = 0;
            log('æ—¥å¿—å·²æ¸…ç©º', 'info');
        }
        
        // åˆå§‹åŒ–
        log('DevToolsé€šä¿¡æµ‹è¯•é¡µé¢å·²åŠ è½½', 'success');
        log('è¯·æŒ‰ç…§è¯´æ˜è¿›è¡Œæµ‹è¯•', 'info');
    </script>
</body>
</html>
