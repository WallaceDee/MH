# 项目架构指导规则

## 🏗️ 整体架构原则

### 分层架构设计
- **展示层 (Presentation Layer)**: Vue.js前端
- **接口层 (API Layer)**: Flask RESTful API
- **业务层 (Business Layer)**: 服务类处理业务逻辑
- **数据层 (Data Layer)**: 数据访问和存储

### 模块化原则
- 单一职责：每个模块只负责一个功能
- 松耦合：模块间依赖最小化
- 高内聚：相关功能集中在同一模块
- 接口统一：统一的接口规范

## 📁 项目结构规范

### 前后端分离架构
```
项目根目录/
├── web/                    # Vue.js前端项目
│   ├── src/
│   │   ├── components/     # 公共组件
│   │   ├── views/          # 页面组件  
│   │   ├── api/            # API接口封装层 ⭐
│   │   │   ├── index.js    # 统一API导出
│   │   │   ├── character.js # 角色相关API
│   │   │   ├── equipment.js # 装备相关API
│   │   │   └── request.js  # axios封装和拦截器
│   │   ├── utils/          # 前端工具类
│   │   │   └── request.js  # 请求工具（响应拦截器）
│   │   ├── store/          # Vuex状态管理
│   │   └── router/         # 路由配置
│   └── package.json
├── src/                    # Python后端项目
│   ├── app/                # Flask应用
│   │   ├── blueprints/     # API蓝图
│   │   │   └── api/v1/     # v1版本API
│   │   ├── controllers/    # 控制器层
│   │   ├── services/       # 服务层
│   │   └── utils/          # 后端工具类
│   └── api/                # 数据访问层
├── data/                   # 数据存储
├── output/                 # 输出文件
├── config/                 # 配置文件
└── docs/                   # 项目文档
```

### 前端API层架构 ⭐
**核心原则：禁止组件直接使用axios，必须通过统一API层**

#### API层职责
1. **请求封装**: 统一HTTP请求配置和调用方式
2. **响应处理**: 自动处理响应数据格式，简化组件数据访问
3. **错误处理**: 统一错误提示和异常处理
4. **类型安全**: 提供明确的API方法和参数类型
5. **代码维护**: 集中管理所有API接口，便于维护和修改

#### API模块组织
```javascript
// api/index.js - 统一导出
export { characterApi } from './character'
export { equipmentApi } from './equipment'

// 组件中使用
this.$api.character.getCharacterList(params)
this.$api.equipment.getEquipmentList(params)
```

#### 响应拦截器优势
- **数据格式统一**: 自动将`response.data.data.data`转换为`response.items`
- **错误自动处理**: 网络错误和HTTP错误自动显示用户友好消息
- **分页数据提取**: 自动提取total、page、pageSize等分页信息
- **业务状态判断**: 提供统一的success/code状态判断

## 🔄 数据流设计

### 前端 → 后端流程
1. **用户操作** → Vue组件
2. **API调用** → `this.$api.module.method()` (统一API)
3. **请求拦截** → 添加通用请求头和日志
4. **路由处理** → Flask蓝图
5. **参数验证** → Controller层
6. **业务处理** → Service层
7. **数据访问** → API/Model层
8. **响应返回** → 统一格式

### 后端 → 前端流程
1. **数据查询** → 业务服务
2. **格式化** → 响应工具
3. **JSON返回** → HTTP响应
4. **响应拦截** → 自动数据格式化和错误处理
5. **状态更新** → Vuex/组件状态 (使用response.items)
6. **界面刷新** → Vue响应式更新

## 🛡️ 安全架构

### API安全
- CORS跨域配置
- 请求参数验证
- SQL注入防护
- 错误信息过滤

### 数据安全
- 敏感数据加密
- 日志脱敏处理
- 文件访问控制
- 数据备份策略

## 📊 性能架构

### 前端性能
- 组件懒加载
- 路由分割
- 资源压缩
- 缓存策略

### 后端性能
- 数据库连接池
- 查询优化
- 异步处理
- 响应缓存

## 🔧 开发架构

### 代码组织
- 功能模块化
- 配置外部化
- 依赖注入
- 接口抽象

### 版本控制
- Git分支策略
- 代码审查流程
- 自动化测试
- 持续集成

## 🚀 部署架构

### 环境分离
- 开发环境 (Development)
- 测试环境 (Testing)  
- 生产环境 (Production)

### 服务部署
- 前端静态资源服务
- 后端API服务
- 数据库服务
- 文件存储服务

## 📝 文档架构

### 技术文档
- API接口文档
- 数据库设计文档
- 部署运维文档
- 架构设计文档

### 开发文档
- 编码规范文档
- 最佳实践指南
- 问题排查手册
- 新手入门指南

## 🔍 监控架构

### 日志监控
- 应用日志收集
- 错误日志告警
- 性能日志分析
- 用户行为跟踪

### 系统监控
- 服务健康检查
- 资源使用监控
- 接口响应时间
- 数据库性能

## ⚡ 扩展架构

### 水平扩展
- 负载均衡
- 服务集群
- 数据分片
- 缓存集群

### 垂直扩展
- 硬件升级
- 代码优化
- 数据库优化
- 架构重构

在开发过程中，始终要考虑架构的可维护性、可扩展性和可测试性，确保项目能够持续健康发展。 